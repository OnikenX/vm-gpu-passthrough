<!DOCTYPE html>
<html class="client-js" dir="ltr" lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><style class="darkreader darkreader--fallback" media="screen"></style><style class="darkreader darkreader--text" media="screen">* {
  font-family: system-ui !important;
}</style><style class="darkreader darkreader--invert" media="screen">.jfk-bubble {
    filter: invert(100%) hue-rotate(180deg) contrast(90%) !important;
}</style><style class="darkreader darkreader--inline" media="screen">[data-darkreader-inline-bgcolor] {
  background-color: var(--darkreader-inline-bgcolor) !important;
}
[data-darkreader-inline-bgimage] {
  background-image: var(--darkreader-inline-bgimage) !important;
}
[data-darkreader-inline-border] {
  border-color: var(--darkreader-inline-border) !important;
}
[data-darkreader-inline-border-bottom] {
  border-bottom-color: var(--darkreader-inline-border-bottom) !important;
}
[data-darkreader-inline-border-left] {
  border-left-color: var(--darkreader-inline-border-left) !important;
}
[data-darkreader-inline-border-right] {
  border-right-color: var(--darkreader-inline-border-right) !important;
}
[data-darkreader-inline-border-top] {
  border-top-color: var(--darkreader-inline-border-top) !important;
}
[data-darkreader-inline-boxshadow] {
  box-shadow: var(--darkreader-inline-boxshadow) !important;
}
[data-darkreader-inline-color] {
  color: var(--darkreader-inline-color) !important;
}
[data-darkreader-inline-fill] {
  fill: var(--darkreader-inline-fill) !important;
}
[data-darkreader-inline-stroke] {
  stroke: var(--darkreader-inline-stroke) !important;
}
[data-darkreader-inline-outline] {
  outline-color: var(--darkreader-inline-outline) !important;
}</style><style class="darkreader darkreader--user-agent" media="screen">html {
    background-color: #181a1b !important;
}
html, body, input, textarea, select, button {
    background-color: #181a1b;
}
html, body, input, textarea, select, button {
    border-color: #575757;
    color: #e8e6e3;
}
a {
    color: #3391ff;
}
table {
    border-color: #4c4c4c;
}
::placeholder {
    color: #bab5ab;
}
::selection {
    background-color: #005ccc;
    color: #ffffff;
}
::-moz-selection {
    background-color: #005ccc;
    color: #ffffff;
}
input:-webkit-autofill,
textarea:-webkit-autofill,
select:-webkit-autofill {
    background-color: #545b00 !important;
    color: #e8e6e3 !important;
}
::-webkit-scrollbar {
    background-color: #1c1e1f;
    color: #c5c1b9;
}
::-webkit-scrollbar-thumb {
    background-color: #2a2c2e;
}
::-webkit-scrollbar-thumb:hover {
    background-color: #323537;
}
::-webkit-scrollbar-thumb:active {
    background-color: #3d4043;
}
::-webkit-scrollbar-corner {
    background-color: #181a1b;
}
* {
    scrollbar-color: #2a2c2e #1c1e1f;
}</style>
<meta charset="UTF-8">
<title>PCI passthrough via OVMF - ArchWiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"PCI_passthrough_via_OVMF","wgTitle":"PCI passthrough via OVMF","wgCurRevisionId":596768,"wgRevisionId":596768,"wgArticleId":20165,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Pages or sections flagged with Template:Accuracy","Pages or sections flagged with Template:Expansion","Pages with broken package links","Sections flagged with Template:Remove","Virtualization"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"PCI_passthrough_via_OVMF","wgRelevantArticleId":20165,"wgRequestId":"ccc6557e15cd3d219cdd21b7","wgCSPNonce":false,"wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.toc.styles":"ready","zzz.ext.archLinux.styles":"ready","skins.vector.styles.responsive":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@0tffind",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});RLPAGEMODULES=["site","mediawiki.page.startup","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"];mw.loader.load(RLPAGEMODULES);});</script>
<link rel="stylesheet" href="PCI%20passthrough%20via%20OVMF%20-%20ArchWiki_files/load.css"><style class="darkreader darkreader--cors" media="screen">@media print{.noprint,.catlinks,.magnify,.mw-cite-backlink,.mw-editsection,.mw-editsection-like,.mw-hidden-catlinks,.mw-indicators,.mw-redirectedfrom,.patrollink,.usermessage,#column-one,#footer-places,#mw-navigation,#siteNotice,#f-poweredbyico,#f-copyrightico,li#about,li#disclaimer,li#mobileview,li#privacy{display:none}body{background:#fff;color:#000;margin:0;padding:0}a{background:none !important;padding:0 !important}a,a.external,a.new,a.stub{color:#000 !important;text-decoration:none !important;color:inherit !important;text-decoration:inherit !important}.mw-parser-output a.external.text:after,.mw-parser-output a.external.autonumber:after{content:' (' attr(href) ')';word-break:break-all;word-wrap:break-word}.mw-parser-output a.external.text[href^='//']:after,.mw-parser-output a.external.autonumber[href^='//']:after{content:' (https:' attr(href) ')'}dt{font-weight:bold}h1,h2,h3,h4,h5,h6{font-weight:bold;page-break-after:avoid;page-break-before:avoid}p{margin:1em 0;line-height:1.2;orphans:3;widows:3}img,figure,.wikitable,.thumb{page-break-inside:avoid}img{border:0;vertical-align:middle}pre,.mw-code{background:#fff;color:#000;border:1pt dashed #000;padding:1em 0;font-size:8pt;white-space:pre-wrap;word-wrap:break-word}sup,sub{line-height:1}ul{list-style-type:square}#globalWrapper{width:100% !important;min-width:0 !important}.mw-body{background:#fff;color:#000;border:0 !important;padding:0 !important;margin:0 !important;direction:ltr}#column-content{margin:0 !important}#column-content .mw-body{padding:1em;margin:0 !important}.toc{background-color:#f9f9f9;border:1pt solid #aaa;padding:5px;display:table}.tocnumber,.toctext{display:table-cell}.tocnumber{padding-left:0;padding-right:0.5em}.mw-content-ltr .tocnumber{padding-left:0;padding-right:0.5em}.mw-content-rtl .tocnumber{padding-left:0.5em;padding-right:0}table.floatright,div.floatright,div.tright{float:right;clear:right;position:relative}table.floatleft,div.floatleft,div.tleft{float:left;clear:left;position:relative}div.tleft{margin:0.5em 1.4em 1.3em 0}div.tright{margin:0.5em 0 1.3em 1.4em}table.floatright,div.floatright{margin:0 0 0.5em 0.5em;border:0}table.floatleft,div.floatleft{margin:0 0.5em 0.5em 0;border:0}.center{text-align:center}div.thumb{background-color:transparent;width:auto}div.thumb a{border-bottom:0}div.thumbinner{background-color:#fff;border:0;border-radius:2px;padding:5px;font-size:10pt;color:#666;text-align:center;overflow:hidden;min-width:100px}html .thumbcaption{text-align:left;line-height:1.4;padding:3px}img.thumbborder{border:1pt solid #ddd}.wikitable,.mw_metadata{background:#fff;margin:1em 0;border:1pt solid #aaa;border-collapse:collapse;font-size:10pt}.wikitable > caption,.mw_metadata caption{padding:5px;font-size:10pt}.wikitable > tr > th,.wikitable > tr > td,.wikitable > * > tr > th,.wikitable > * > tr > td,.mw_metadata th,.mw_metadata td{background:#fff !important;color:#000 !important;border:1pt solid #aaa;padding:0.4em 0.6em}.wikitable > tr > th,.wikitable > * > tr > th,.mw_metadata th{text-align:center}table.listing,table.listing td{border:1pt solid #000;border-collapse:collapse}.catlinks ul{display:inline;padding:0;list-style:none none}.catlinks li{display:inline-block;line-height:1.15;margin:0.1em 0;border-left:1pt solid #aaa;padding:0 0.4em}.catlinks li:first-child{border-left:0;padding-left:0.2em}.printfooter{padding:1em 0}#footer{background:#fff;color:#000;margin-top:1em;border-top:1pt solid #aaa;padding-top:5px;direction:ltr}}@media screen{.mw-content-ltr{direction:ltr}.mw-content-rtl{direction:rtl}.sitedir-ltr textarea,.sitedir-ltr input{direction:ltr}.sitedir-rtl textarea,.sitedir-rtl input{direction:rtl}.mw-userlink{unicode-bidi:embed}mark{background-color:#ff0;color:#000}wbr{display:inline-block}input[type='submit'],input[type='button'],input[type='reset'],input[type='file']{direction:ltr}textarea[dir='ltr'],input[dir='ltr']{direction:ltr}textarea[dir='rtl'],input[dir='rtl']{direction:rtl}abbr[title],.explain[title]{border-bottom:1px dotted;cursor:help}@supports (text-decoration:underline dotted){abbr[title],.explain[title]{border-bottom:0;text-decoration:underline dotted}}span.comment{font-style:italic;unicode-bidi:-moz-isolate;unicode-bidi:isolate}#editform,#toolbar,#wpTextbox1{clear:both}#toolbar{height:22px}.mw-underline-always a{text-decoration:underline}.mw-underline-never a{text-decoration:none}li span.deleted,span.history-deleted{text-decoration:line-through;color:#72777d;font-style:italic}.not-patrolled{background-color:#ffa}.unpatrolled{font-weight:bold;color:#d33}div.patrollink{font-size:75%;text-align:right}td.mw-label{text-align:right;vertical-align:middle}td.mw-input{text-align:left}td.mw-submit{text-align:left;white-space:nowrap}.mw-input-with-label{white-space:nowrap;display:inline-block}.mw-content-ltr .thumbcaption{text-align:left}.mw-content-ltr .magnify{float:right}.mw-content-rtl .thumbcaption{text-align:right}.mw-content-rtl .magnify{float:left}#catlinks{text-align:left}.catlinks ul{display:inline;margin:0;padding:0;list-style:none none;vertical-align:middle !ie}.catlinks li{display:inline-block;line-height:1.25em;border-left:1px solid #a2a9b1;margin:0.125em 0;padding:0 0.5em;zoom:1;display:inline !ie}.catlinks li:first-child{padding-left:0.25em;border-left:0}.catlinks li a.mw-redirect{font-style:italic}.mw-hidden-cats-hidden{display:none}.catlinks-allhidden{display:none}p.mw-protect-editreasons,p.mw-filedelete-editreasons,p.mw-delete-editreasons{font-size:90%;text-align:right}.autocomment,.autocomment a,.autocomment a:visited{color:#72777d}.newpage,.minoredit,.botedit{font-weight:bold}div.mw-warning-with-logexcerpt{padding:3px;margin-bottom:3px;border:2px solid #2a4b8d;clear:both}div.mw-warning-with-logexcerpt ul li{font-size:90%}span.mw-revdelundel-link,strong.mw-revdelundel-link{font-size:90%}span.mw-revdelundel-hidden,input.mw-revdelundel-hidden{visibility:hidden}td.mw-revdel-checkbox,th.mw-revdel-checkbox{padding-right:10px;text-align:center}a.new{color:#ba0000}.plainlinks a.external{background:none !important;padding:0 !important}.rtl a.external.free,.rtl a.external.autonumber{direction:ltr;unicode-bidi:embed}.wikitable{background-color:#f8f9fa;color:#222;margin:1em 0;border:1px solid #a2a9b1;border-collapse:collapse}.wikitable > tr > th,.wikitable > tr > td,.wikitable > * > tr > th,.wikitable > * > tr > td{border:1px solid #a2a9b1;padding:0.2em 0.4em}.wikitable > tr > th,.wikitable > * > tr > th{background-color:#eaecf0;text-align:center}.wikitable > caption{font-weight:bold}.error,.warning,.success{font-size:larger}.error{color:#d33}.warning{color:#705000}.success{color:#009000}.errorbox,.warningbox,.successbox{border:1px solid;padding:0.5em 1em;margin-bottom:1em;display:inline-block;zoom:1;*display:inline}.errorbox h2,.warningbox h2,.successbox h2{font-size:1em;color:inherit;font-weight:bold;display:inline;margin:0 0.5em 0 0;border:0}.errorbox{color:#d33;border-color:#fac5c5;background-color:#fae3e3}.warningbox{color:#705000;border-color:#fde29b;background-color:#fdf1d1}.successbox{color:#008000;border-color:#b7fdb5;background-color:#e1fddf}.mw-infobox{border:2px solid #ff7f00;margin:0.5em;clear:left;overflow:hidden}.mw-infobox-left{margin:7px;float:left;width:35px}.mw-infobox-right{margin:0.5em 0.5em 0.5em 49px}.previewnote{color:#d33;margin-bottom:1em}.previewnote p{text-indent:3em;margin:0.8em 0}.visualClear{clear:both}.mw-datatable{border:1px solid #a2a9b1;border-collapse:collapse}.mw-datatable td,.mw-datatable th{border:1px solid #a2a9b1;padding:0.2em 0.4em}.mw-datatable th{background-color:#eaeeff}.mw-datatable td{background-color:#fff}.mw-datatable tr:hover td{background-color:#eaf3ff}.mw-content-ltr ul,.mw-content-rtl .mw-content-ltr ul{margin:0.3em 0 0 1.6em;padding:0}.mw-content-rtl ul,.mw-content-ltr .mw-content-rtl ul{margin:0.3em 1.6em 0 0;padding:0}.mw-content-ltr ol,.mw-content-rtl .mw-content-ltr ol{margin:0.3em 0 0 3.2em;padding:0}.mw-content-rtl ol,.mw-content-ltr .mw-content-rtl ol{margin:0.3em 3.2em 0 0;padding:0}.mw-content-ltr dd,.mw-content-rtl .mw-content-ltr dd{margin-left:1.6em;margin-right:0}.mw-content-rtl dd,.mw-content-ltr .mw-content-rtl dd{margin-right:1.6em;margin-left:0}.mw-ajax-loader{background-image:url("https://wiki.archlinux.org/resources/src/mediawiki.legacy/images/ajax-loader.gif?57f34");background-position:center center;background-repeat:no-repeat;padding:16px;position:relative;top:-16px}.mw-small-spinner{padding:10px !important;margin-right:0.6em;background-image:url("https://wiki.archlinux.org/resources/src/mediawiki.legacy/images/spinner.gif?ca65b");background-position:center center;background-repeat:no-repeat}h1:lang(anp),h1:lang(as),h1:lang(bh),h1:lang(bho),h1:lang(bn),h1:lang(gu),h1:lang(hi),h1:lang(kn),h1:lang(ks),h1:lang(ml),h1:lang(mr),h1:lang(my),h1:lang(mai),h1:lang(ne),h1:lang(new),h1:lang(or),h1:lang(pa),h1:lang(pi),h1:lang(sa),h1:lang(ta),h1:lang(te){line-height:1.6em !important}h2:lang(anp),h3:lang(anp),h4:lang(anp),h5:lang(anp),h6:lang(anp),h2:lang(as),h3:lang(as),h4:lang(as),h5:lang(as),h6:lang(as),h2:lang(bho),h3:lang(bho),h4:lang(bho),h5:lang(bho),h6:lang(bho),h2:lang(bh),h3:lang(bh),h4:lang(bh),h5:lang(bh),h6:lang(bh),h2:lang(bn),h3:lang(bn),h4:lang(bn),h5:lang(bn),h6:lang(bn),h2:lang(gu),h3:lang(gu),h4:lang(gu),h5:lang(gu),h6:lang(gu),h2:lang(hi),h3:lang(hi),h4:lang(hi),h5:lang(hi),h6:lang(hi),h2:lang(kn),h3:lang(kn),h4:lang(kn),h5:lang(kn),h6:lang(kn),h2:lang(ks),h3:lang(ks),h4:lang(ks),h5:lang(ks),h6:lang(ks),h2:lang(ml),h3:lang(ml),h4:lang(ml),h5:lang(ml),h6:lang(ml),h2:lang(mr),h3:lang(mr),h4:lang(mr),h5:lang(mr),h6:lang(mr),h2:lang(my),h3:lang(my),h4:lang(my),h5:lang(my),h6:lang(my),h2:lang(mai),h3:lang(mai),h4:lang(mai),h5:lang(mai),h6:lang(mai),h2:lang(ne),h3:lang(ne),h4:lang(ne),h5:lang(ne),h6:lang(ne),h2:lang(new),h3:lang(new),h4:lang(new),h5:lang(new),h6:lang(new),h2:lang(or),h3:lang(or),h4:lang(or),h5:lang(or),h6:lang(or),h2:lang(pa),h3:lang(pa),h4:lang(pa),h5:lang(pa),h6:lang(pa),h2:lang(pi),h3:lang(pi),h4:lang(pi),h5:lang(pi),h6:lang(pi),h2:lang(sa),h3:lang(sa),h4:lang(sa),h5:lang(sa),h6:lang(sa),h2:lang(ta),h3:lang(ta),h4:lang(ta),h5:lang(ta),h6:lang(ta),h2:lang(te),h3:lang(te),h4:lang(te),h5:lang(te),h6:lang(te){line-height:1.2em}ol:lang(azb) li,ol:lang(bcc) li,ol:lang(bgn) li,ol:lang(bqi) li,ol:lang(fa) li,ol:lang(glk) li,ol:lang(kk-arab) li,ol:lang(lrc) li,ol:lang(luz) li,ol:lang(mzn) li{list-style-type:-moz-persian;list-style-type:persian}ol:lang(ckb) li,ol:lang(sdh) li{list-style-type:-moz-arabic-indic;list-style-type:arabic-indic}ol:lang(hi) li,ol:lang(mai) li,ol:lang(mr) li,ol:lang(ne) li{list-style-type:-moz-devanagari;list-style-type:devanagari}ol:lang(as) li,ol:lang(bn) li{list-style-type:-moz-bengali;list-style-type:bengali}ol:lang(or) li{list-style-type:-moz-oriya;list-style-type:oriya}.toc ul{margin:0.3em 0}.mw-content-ltr .toc ul,.mw-content-rtl .mw-content-ltr .toc ul{text-align:left}.mw-content-rtl .toc ul,.mw-content-ltr .mw-content-rtl .toc ul{text-align:right}.mw-content-ltr .toc ul ul,.mw-content-rtl .mw-content-ltr .toc ul ul{margin:0 0 0 2em}.mw-content-rtl .toc ul ul,.mw-content-ltr .mw-content-rtl .toc ul ul{margin:0 2em 0 0}.toc .toctitle{direction:ltr}#mw-clearyourcache,#mw-sitecsspreview,#mw-sitejspreview,#mw-usercsspreview,#mw-userjspreview{direction:ltr;unicode-bidi:embed}#mw-revision-info,#mw-revision-info-current,#mw-revision-nav{direction:ltr}div.tright,div.floatright,table.floatright{clear:right;float:right}div.tleft,div.floatleft,table.floatleft{float:left;clear:left}div.floatright,table.floatright,div.floatleft,table.floatleft{position:relative}#mw-credits a{unicode-bidi:embed}.printfooter{display:none}.xdebug-error{position:absolute;z-index:99}.mw-editsection{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mw-editsection,.mw-editsection-like{font-size:small;font-weight:normal;margin-left:1em;vertical-align:baseline;line-height:1em}.mw-content-ltr .mw-editsection,.mw-content-rtl .mw-content-ltr .mw-editsection{margin-left:1em}.mw-content-rtl .mw-editsection,.mw-content-ltr .mw-content-rtl .mw-editsection{margin-right:1em}sup,sub{line-height:1}}@media screen{a{text-decoration:none;color:#0645ad;background:none}a:not([href]){cursor:pointer}a:visited{color:#0b0080}a:active{color:#faa700}a:hover,a:focus{text-decoration:underline}a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}a.stub{color:#723}a.new,#p-personal a.new{color:#ba0000}a.mw-selflink{color:inherit;font-weight:bold;text-decoration:inherit}a.mw-selflink:hover{cursor:inherit;text-decoration:inherit}a.mw-selflink:active,a.mw-selflink:visited{color:inherit}a.new:visited,#p-personal a.new:visited{color:#a55858}.mw-parser-output a.extiw,.mw-parser-output a.extiw:active{color:#36b}.mw-parser-output a.extiw:visited{color:#636}.mw-parser-output a.extiw:active{color:#b63}.mw-parser-output a.external{color:#36b}.mw-parser-output a.external:visited{color:#636}.mw-parser-output a.external:active{color:#b63}.mw-parser-output a.external.free{word-wrap:break-word}img{border:0;vertical-align:middle}hr{height:1px;color:#a2a9b1;background-color:#a2a9b1;border:0;margin:0.2em 0}h1,h2,h3,h4,h5,h6{color:#000;background:none;font-weight:normal;margin:0;overflow:hidden;padding-top:0.5em;padding-bottom:0.17em;border-bottom:1px solid #a2a9b1}h1{font-size:188%}h2{font-size:150%}h3,h4,h5,h6{border-bottom:0;font-weight:bold}h3{font-size:128%}h4{font-size:116%}h5{font-size:108%}h6{font-size:100%}h1,h2{margin-bottom:0.6em}h3,h4,h5{margin-bottom:0.3em}p{margin:0.4em 0 0.5em 0}p img{margin:0}ul{margin:0.3em 0 0 1.6em;padding:0}ol{margin:0.3em 0 0 3.2em;padding:0;list-style-image:none}li{margin-bottom:0.1em}dt{font-weight:bold;margin-bottom:0.1em}dl{margin-top:0.2em;margin-bottom:0.5em}dd{margin-left:1.6em;margin-bottom:0.1em}pre,code,tt,kbd,samp,.mw-code{font-family:monospace,monospace}code{color:#000;background-color:#f8f9fa;border:1px solid #eaecf0;border-radius:2px;padding:1px 4px}pre,.mw-code{color:#000;background-color:#f8f9fa;border:1px solid #eaecf0;padding:1em;white-space:pre-wrap}table{font-size:100%}fieldset{border:1px solid #2a4b8d;margin:1em 0 1em 0;padding:0 1em 1em}fieldset.nested{margin:0 0 0.5em 0;padding:0 0.5em 0.5em}legend{padding:0.5em;font-size:95%}form{border:0;margin:0}textarea{width:100%;padding:0.1em;display:block;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}.center{width:100%;text-align:center}*.center *{margin-left:auto;margin-right:auto}.small{font-size:94%}table.small{font-size:100%}.toc,.mw-warning,.toccolours{border:1px solid #a2a9b1;background-color:#f8f9fa;padding:5px;font-size:95%}.toc{display:inline-block;display:table;zoom:1;*display:inline;padding:7px}table.toc{border-collapse:collapse}table.toc td{padding:0}.toc h2{display:inline;border:0;padding:0;font-size:100%;font-weight:bold}.toc .toctitle{text-align:center}.toc ul{list-style-type:none;list-style-image:none;margin-left:0;padding:0;text-align:left}.toc ul ul{margin:0 0 0 2em}.tocnumber,.toctext{display:table-cell;text-decoration:inherit}.tocnumber{padding-left:0;padding-right:0.5em;color:#222}.mw-content-ltr .tocnumber{padding-left:0;padding-right:0.5em}.mw-content-rtl .tocnumber{padding-left:0.5em;padding-right:0}.mw-warning{margin-left:50px;margin-right:50px;text-align:center}div.floatright,table.floatright{margin:0 0 0.5em 0.5em}div.floatleft,table.floatleft{margin:0 0.5em 0.5em 0}div.thumb{margin-bottom:0.5em;width:auto;background-color:transparent}div.thumbinner{border:1px solid #c8ccd1;padding:3px;background-color:#f8f9fa;font-size:94%;text-align:center;overflow:hidden}html .thumbimage{background-color:#fff;border:1px solid #c8ccd1}html .thumbcaption{border:0;line-height:1.4em;padding:3px;font-size:94%;text-align:left}div.magnify{float:right;margin-left:3px}div.magnify a{display:block;text-indent:15px;white-space:nowrap;overflow:hidden;width:15px;height:11px;background-image:url("https://wiki.archlinux.org/resources/src/mediawiki.skinning/images/magnify-clip-ltr.png?4f704");background-image:linear-gradient(transparent,transparent),url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2215%22 height=%2211%22 viewBox=%220 0 11 15%22%3E %3Cg id=%22magnify-clip%22 fill=%22%23fff%22 stroke=%22%23000%22%3E %3Cpath id=%22bigbox%22 d=%22M1.509 1.865h10.99v7.919H1.509z%22/%3E %3Cpath id=%22smallbox%22 d=%22M-1.499 6.868h5.943v4.904h-5.943z%22/%3E %3C/g%3E %3C/svg%3E");-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}img.thumbborder{border:1px solid #eaecf0}.mw-content-ltr .thumbcaption{text-align:left}.mw-content-ltr .magnify{float:right;margin-left:3px;margin-right:0}.mw-content-ltr div.magnify a{background-image:url("https://wiki.archlinux.org/resources/src/mediawiki.skinning/images/magnify-clip-ltr.png?4f704");background-image:linear-gradient(transparent,transparent),url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2215%22 height=%2211%22 viewBox=%220 0 11 15%22%3E %3Cg id=%22magnify-clip%22 fill=%22%23fff%22 stroke=%22%23000%22%3E %3Cpath id=%22bigbox%22 d=%22M1.509 1.865h10.99v7.919H1.509z%22/%3E %3Cpath id=%22smallbox%22 d=%22M-1.499 6.868h5.943v4.904h-5.943z%22/%3E %3C/g%3E %3C/svg%3E")}.mw-content-rtl .thumbcaption{text-align:right}.mw-content-rtl .magnify{float:left;margin-left:0;margin-right:3px}.mw-content-rtl div.magnify a{background-image:url("https://wiki.archlinux.org/resources/src/mediawiki.skinning/images/magnify-clip-rtl.png?a9fb3");background-image:linear-gradient(transparent,transparent),url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2215%22 height=%2211%22 viewBox=%220 0 11 15%22%3E %3Cg id=%22magnify-clip%22 fill=%22%23fff%22 stroke=%22%23000%22%3E %3Cpath id=%22bigbox%22 d=%22M9.491 1.865h-10.99v7.919h10.99z%22/%3E %3Cpath id=%22smallbox%22 d=%22M12.499 6.868H6.556v4.904h5.943z%22/%3E %3C/g%3E %3C/svg%3E")}div.tright{margin:0.5em 0 1.3em 1.4em}div.tleft{margin:0.5em 1.4em 1.3em 0}body.mw-hide-empty-elt .mw-empty-elt{display:none}.catlinks{border:1px solid #a2a9b1;background-color:#f8f9fa;padding:5px;margin-top:1em;clear:both}textarea{border:1px solid #c8ccd1}.editOptions{background-color:#eaecf0;color:#222;border:1px solid #c8ccd1;border-top:0;padding:1em 1em 1.5em 1em;margin-bottom:2em}.usermessage{background-color:#ffce7b;border:1px solid #ffa500;color:#000;font-weight:bold;margin:2em 0 1em;padding:0.5em 1em;vertical-align:middle}#siteNotice{position:relative;text-align:center;margin:0}#localNotice{margin-bottom:0.9em}.firstHeading{margin-bottom:0.1em;line-height:1.2em;padding-bottom:0}#siteSub{display:none}#contentSub,#contentSub2{font-size:84%;line-height:1.2em;margin:0 0 1.4em 1em;color:#54595d;width:auto}span.subpages{display:block}}.mw-wiki-logo{background-image:url("")}.toctogglecheckbox:checked ~ ul{display:none}@media screen{:not(:checked) > .toctogglecheckbox{display:inline !important;position:absolute;opacity:0;z-index:-1}.toctogglespan{font-size:94%}:not(:checked) > .toctogglespan:before{content:' ['}:not(:checked) > .toctogglespan:after{content:']'}.toctogglelabel{cursor:pointer;color:#0645ad}.toctogglelabel:hover{text-decoration:underline}.toctogglecheckbox:focus + .toctitle .toctogglelabel{text-decoration:underline;outline:dotted 1px;outline:auto -webkit-focus-ring-color}.toctogglecheckbox:checked + .toctitle .toctogglelabel:after{content:'show'}.toctogglecheckbox:not(:checked) + .toctitle .toctogglelabel:after{content:'hide'}}@media print{.toctogglecheckbox:checked + .toctitle{display:none}}@media screen{html{font-size:100%}html,body{height:100%;margin:0;padding:0;font-family:sans-serif}body{background-color:#f6f6f6}.mw-body,.parsoid-body{padding:1em;background-color:#ffffff;color:#222222;direction:ltr}.mw-body{margin-left:10em;border:1px solid #a7d7f9;border-right-width:0;margin-top:-1px}.mw-body h1,.mw-body-content h1,.mw-body-content h2{font-family:'Linux Libertine','Georgia','Times',serif;line-height:1.3;margin-bottom:0.25em;padding:0}.mw-body h1:lang(ja),.mw-body-content h1:lang(ja),.mw-body-content h2:lang(ja),.mw-body h1:lang(he),.mw-body-content h1:lang(he),.mw-body-content h2:lang(he),.mw-body h1:lang(ko),.mw-body-content h1:lang(ko),.mw-body-content h2:lang(ko){font-family:sans-serif}.mw-body h1:lang(my),.mw-body-content h1:lang(my),.mw-body-content h2:lang(my){line-height:normal}.mw-body h1,.mw-body-content h1{font-size:1.8em}.mw-body .firstHeading{overflow:visible}.mw-body .mw-indicators{float:right;line-height:1.6;font-size:0.875em;position:relative;z-index:1}.mw-body .mw-indicator{display:inline-block;zoom:1;*display:inline}.mw-body-content{position:relative;line-height:1.6;font-size:0.875em;z-index:0}.mw-body-content p{line-height:inherit;margin:0.5em 0}.mw-body-content h1{margin-top:1em}.mw-body-content h2{font-size:1.5em;margin-top:1em}.mw-body-content h3,.mw-body-content h4,.mw-body-content h5,.mw-body-content h6{line-height:1.6;margin-top:0.3em;margin-bottom:0;padding-bottom:0}.mw-body-content h3{font-size:1.2em}.mw-body-content h3,.mw-body-content h4{font-weight:bold}.mw-body-content h4,.mw-body-content h5,.mw-body-content h6{font-size:100%}.mw-body-content .toc h2{font-size:100%;font-family:sans-serif}.mw-editsection,.mw-editsection-like{font-family:sans-serif}div.emptyPortlet{display:none}ul{list-style-image:url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%225%22 height=%2213%22%3E %3Ccircle cx=%222.5%22 cy=%229%22 r=%222.5%22 fill=%22%23222%22/%3E %3C/svg%3E")}pre,.mw-code{line-height:1.3em}#siteNotice{font-size:0.8em}#p-personal{position:absolute;top:0.33em;right:0.75em;z-index:100}#p-personal h3{display:none}#p-personal ul{list-style:none none;margin:0;padding-left:10em}#p-personal li{float:left;margin-left:0.75em;padding-top:0.5em;font-size:0.75em;line-height:1.16666667em;white-space:nowrap}#pt-anonuserpage,#pt-userpage a{background-image:url("https://wiki.archlinux.org/skins/Vector/images/user-avatar.png?59494");background-image:linear-gradient(transparent,transparent),url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2220%22 height=%2220%22 viewBox=%220 0 20 20%22%3E %3Cg fill=%22%2354595d%22%3E %3Cpath d=%22M10 11c-5.92 0-8 3-8 5v3h16v-3c0-2-2.08-5-8-5z%22/%3E %3Ccircle cx=%2210%22 cy=%225.5%22 r=%224.5%22/%3E %3C/g%3E %3C/svg%3E");background-position:left 0.33333333em;background-repeat:no-repeat;background-size:1.16666667em 1.16666667em;padding-top:0.5em !important;padding-left:16px !important}#pt-userpage{padding-top:0 !important}#pt-userpage a{display:inline-block}#pt-anonuserpage{color:#54595d}#p-search{float:left;margin-right:0.5em;margin-left:0.5em}#p-search h3{display:block;position:absolute !important;clip:rect(1px,1px,1px,1px);width:1px;height:1px;margin:-1px;border:0;padding:0;overflow:hidden}#p-search form,#p-search input{margin:0.4em 0 0}#simpleSearch{background-color:#fff;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAQCAIAAABY/YLgAAAAJUlEQVQIHQXBsQEAAAjDoND/73UWdnerhmHVsDQZJrNWVg3Dqge6bgMe6bejNAAAAABJRU5ErkJggg==");background-image:url("https://wiki.archlinux.org/skins/Vector/images/search-fade.png?50f7b")!ie;background-position:top left;background-repeat:repeat-x;color:#000;display:block;width:12.6em;width:20vw;min-width:5em;max-width:20em;padding-right:1.4em;height:1.4em;margin-top:0.65em;position:relative;min-height:1px;border:1px solid #a2a9b1;border-radius:2px;-webkit-transition:border-color 250ms;-moz-transition:border-color 250ms;transition:border-color 250ms}#simpleSearch:hover{border-color:#72777d}#simpleSearch input{background-color:transparent;color:#000;margin:0;padding:0;border:0}#simpleSearch #searchInput{width:100%;padding:0.2em 0 0.2em 0.2em;font-size:0.8125em;direction:ltr;-webkit-appearance:textfield}#simpleSearch #searchInput:focus{outline:0}#simpleSearch #searchInput::-webkit-input-placeholder{color:#72777d;opacity:1}#simpleSearch #searchInput:-ms-input-placeholder{color:#72777d;opacity:1}#simpleSearch #searchInput::-moz-placeholder{color:#72777d;opacity:1}#simpleSearch #searchInput:-moz-placeholder{color:#72777d;opacity:1}#simpleSearch #searchInput::placeholder{color:#72777d;opacity:1}#simpleSearch #searchInput::-webkit-search-decoration,#simpleSearch #searchInput::-webkit-search-cancel-button,#simpleSearch #searchInput::-webkit-search-results-button,#simpleSearch #searchInput::-webkit-search-results-decoration{-webkit-appearance:textfield}#simpleSearch #searchButton,#simpleSearch #mw-searchButton{position:absolute;top:0;right:0;width:1.65em;height:100%;cursor:pointer;text-indent:-99999px;direction:ltr;white-space:nowrap;overflow:hidden}#simpleSearch #searchButton{background-image:url("https://wiki.archlinux.org/skins/Vector/images/search-ltr.png?39f97");background-image:linear-gradient(transparent,transparent),url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2212%22 height=%2213%22%3E %3Cg fill=%22none%22 stroke=%22%2354595d%22 stroke-width=%222%22%3E %3Cpath d=%22M11.29 11.71l-4-4%22/%3E %3Ccircle cx=%225%22 cy=%225%22 r=%224%22/%3E %3C/g%3E %3C/svg%3E");background-position:center center;background-repeat:no-repeat}#simpleSearch #mw-searchButton{z-index:1}.vectorTabs{float:left;height:2.5em;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAuCAIAAABmjeQ9AAAAQ0lEQVR4AWVOhQEAIAzC/X+xAXbXeoDFGA3A9yk1n4juBROcUegfarWjP3ojZvEzxs6j+nygmo+zzsk79nY+tOxdEhlf3UHVgUFrVwAAAABJRU5ErkJggg==");background-image:url("https://wiki.archlinux.org/skins/Vector/images/tab-break.png?09d4b")!ie;background-position:bottom left;background-repeat:no-repeat;padding-left:1px}.vectorTabs h3{display:none}.vectorTabs ul{float:left;height:100%;list-style:none none;margin:0;padding:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAuCAIAAABmjeQ9AAAAQ0lEQVR4AWVOhQEAIAzC/X+xAXbXeoDFGA3A9yk1n4juBROcUegfarWjP3ojZvEzxs6j+nygmo+zzsk79nY+tOxdEhlf3UHVgUFrVwAAAABJRU5ErkJggg==");background-image:url("https://wiki.archlinux.org/skins/Vector/images/tab-break.png?09d4b")!ie;background-position:right bottom;background-repeat:no-repeat}.vectorTabs li{float:left;line-height:1.125em;display:block;height:100%;margin:0;padding:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAABkCAIAAADITs03AAAAO0lEQVR4AeSKhREAMQzDdN5/5uixuEKDpqgBjl2f78wd2DVj1+26/h///PfteVMN7zoGebcg1/Y/ZQQAlAUtQCujIJMAAAAASUVORK5CYII=");background-image:url("https://wiki.archlinux.org/skins/Vector/images/tab-normal-fade.png?1cc52")!ie;background-position:bottom left;background-repeat:repeat-x;white-space:nowrap}.vectorTabs li.new a,.vectorTabs li.new a:visited{color:#a55858}.vectorTabs li.selected{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAABkAQAAAABvV2fNAAAADElEQVR4AWNoGB4QAInlMgFKeRKBAAAAAElFTkSuQmCC");background-image:url("https://wiki.archlinux.org/skins/Vector/images/tab-current-fade.png?22887")!ie}.vectorTabs li.selected a,.vectorTabs li.selected a:visited{color:#222;text-decoration:none}.vectorTabs li.icon a{background-position:bottom right;background-repeat:no-repeat}.vectorTabs li a{display:block;height:1.9em;padding-left:0.615em;padding-right:0.615em;color:#0645ad;cursor:pointer;font-size:0.8125em}.vectorTabs span{display:inline-block;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAuCAIAAABmjeQ9AAAAQ0lEQVR4AWVOhQEAIAzC/X+xAXbXeoDFGA3A9yk1n4juBROcUegfarWjP3ojZvEzxs6j+nygmo+zzsk79nY+tOxdEhlf3UHVgUFrVwAAAABJRU5ErkJggg==");background-image:url("https://wiki.archlinux.org/skins/Vector/images/tab-break.png?09d4b")!ie;background-position:bottom right;background-repeat:no-repeat;height:100%}.vectorTabs span a{float:left;display:block;position:relative;padding-top:1.25em}.vectorMenu{direction:ltr;float:left;cursor:pointer;position:relative;line-height:1.125em}.vectorMenu h3 span{position:relative;display:block;font-size:0.8125em;padding-left:0.615em;padding-top:1.25em;padding-right:16px;font-weight:normal;color:#444}.vectorMenu h3 span:after{content:'';position:absolute;top:1.25em;right:0;bottom:0;left:0;background-image:url("https://wiki.archlinux.org/skins/Vector/images/arrow-down.png?42edd");background-image:linear-gradient(transparent,transparent),url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2212%22 height=%2212%22 viewBox=%220 0 12 12%22%3E %3Cpath d=%22M11.05 3.996l-.965-1.053-4.035 3.86-3.947-3.86L1.05 3.996l5 5 5-5%22 fill=%22%23222%22/%3E %3C/svg%3E");background-position:100% 50%;background-repeat:no-repeat;opacity:0.85}.vectorMenu h3:hover span,.vectorMenu h3:focus span{color:#222222}.vectorMenu h3:hover span:after,.vectorMenu h3:focus span:after{opacity:1}.vectorMenu .menu{list-style:none none;background-color:#ffffff;clear:both;min-width:100%;position:absolute;top:2.5em;left:-1px;margin:0;border:1px solid #a2a9b1;border-top-width:0;padding:0;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1);text-align:left;opacity:0;visibility:hidden;-webkit-transition:opacity 100ms;-moz-transition:opacity 100ms;transition:opacity 100ms;z-index:2}.vectorMenu:hover .menu{opacity:1;visibility:visible}.vectorMenu .vectorMenuCheckbox:checked ~ .menu{opacity:1;visibility:visible}.vectorMenu ul{list-style:none none;padding:0;margin:0;text-align:left}.vectorMenu li{padding:0;margin:0;text-align:left;line-height:1em}.vectorMenu li a{display:block;padding:0.625em;white-space:nowrap;color:#0645ad;cursor:pointer;font-size:0.8125em}.vectorMenu li.selected a,.vectorMenu li.selected a:visited{color:#222;text-decoration:none}#mw-head .vectorMenu h3{float:left;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAuCAIAAABmjeQ9AAAAQ0lEQVR4AWVOhQEAIAzC/X+xAXbXeoDFGA3A9yk1n4juBROcUegfarWjP3ojZvEzxs6j+nygmo+zzsk79nY+tOxdEhlf3UHVgUFrVwAAAABJRU5ErkJggg==");background-image:url("https://wiki.archlinux.org/skins/Vector/images/tab-break.png?09d4b")!ie;background-repeat:no-repeat;background-position:bottom right;font-size:1em;height:2.5em;padding:0 0.5em 0 0;margin:0 -1px 0 0}.vectorMenuCheckbox{cursor:pointer;position:absolute;top:0;left:0;z-index:1;opacity:0;width:100%;height:100%;margin:0;padding:0;display:none}:not(:checked) > .vectorMenuCheckbox{display:block}.vectorMenuCheckbox:checked + h3 span:after{transform:scaleY(-1)}.vectorMenuCheckbox:focus + h3{outline:dotted 1px;outline:auto -webkit-focus-ring-color}@-webkit-keyframes rotate{from{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes rotate{from{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes rotate{from{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);transform:rotate(360deg)}}.vectorTabs #ca-unwatch.icon a,.vectorTabs #ca-watch.icon a{margin:0;padding:0;display:block;width:28px;padding-top:3.07692308em;height:0;overflow:hidden;background-position:5px 60%;background-repeat:no-repeat}.vectorTabs #ca-unwatch.icon a{background-image:url("https://wiki.archlinux.org/skins/Vector/images/unwatch-icon.png?fccbe");background-image:linear-gradient(transparent,transparent),url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2216%22 height=%2216%22 xmlns:xlink=%22http://www.w3.org/1999/xlink%22%3E %3Cdefs%3E %3ClinearGradient id=%22a%22%3E %3Cstop offset=%220%22 stop-color=%22%23c2edff%22/%3E %3Cstop offset=%22.5%22 stop-color=%22%2368bdff%22/%3E %3Cstop offset=%221%22 stop-color=%22%23fff%22/%3E %3C/linearGradient%3E %3ClinearGradient id=%22b%22 x1=%2213.47%22 x2=%224.596%22 y1=%2214.363%22 y2=%223.397%22 xlink:href=%22%23a%22 gradientUnits=%22userSpaceOnUse%22/%3E %3C/defs%3E %3Cpath fill=%22url%28%23b%29%22 stroke=%22%237cb5d1%22 stroke-width=%22.99992%22 d=%22M8.103 1.146l2.175 4.408 4.864.707-3.52 3.431.831 4.845-4.351-2.287-4.351 2.287.831-4.845-3.52-3.431 4.864-.707z%22/%3E %3C/svg%3E")}.vectorTabs #ca-watch.icon a{background-image:url("https://wiki.archlinux.org/skins/Vector/images/watch-icon.png?e1b42");background-image:linear-gradient(transparent,transparent),url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2216%22 height=%2216%22%3E %3Cpath fill=%22%23fff%22 stroke=%22%237cb5d1%22 stroke-width=%22.99992%22 d=%22M8.103 1.146l2.175 4.408 4.864.707-3.52 3.431.831 4.845-4.351-2.287-4.351 2.287.831-4.845-3.52-3.431 4.864-.707z%22/%3E %3C/svg%3E")}.vectorTabs #ca-unwatch.icon a:hover,.vectorTabs #ca-unwatch.icon a:focus{background-image:url("https://wiki.archlinux.org/skins/Vector/images/unwatch-icon-hl.png?c4723");background-image:linear-gradient(transparent,transparent),url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2216%22 height=%2216%22 xmlns:xlink=%22http://www.w3.org/1999/xlink%22%3E %3Cdefs%3E %3ClinearGradient id=%22a%22%3E %3Cstop offset=%220%22 stop-color=%22%23c2edff%22/%3E %3Cstop offset=%22.5%22 stop-color=%22%2368bdff%22/%3E %3Cstop offset=%221%22 stop-color=%22%23fff%22/%3E %3C/linearGradient%3E %3ClinearGradient id=%22b%22 x1=%2213.47%22 x2=%224.596%22 y1=%2214.363%22 y2=%223.397%22 xlink:href=%22%23a%22 gradientUnits=%22userSpaceOnUse%22/%3E %3C/defs%3E %3Cpath fill=%22url%28%23b%29%22 stroke=%22%23c8b250%22 stroke-width=%22.99992%22 d=%22M8.103 1.146l2.175 4.408 4.864.707-3.52 3.431.831 4.845-4.351-2.287-4.351 2.287.831-4.845-3.52-3.431 4.864-.707z%22/%3E %3C/svg%3E")}.vectorTabs #ca-watch.icon a:hover,.vectorTabs #ca-watch.icon a:focus{background-image:url("https://wiki.archlinux.org/skins/Vector/images/watch-icon-hl.png?f4c7e");background-image:linear-gradient(transparent,transparent),url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2216%22 height=%2216%22%3E %3Cpath fill=%22%23fff%22 stroke=%22%23c8b250%22 stroke-width=%22.99992%22 d=%22M8.103 1.146l2.175 4.408 4.864.707-3.52 3.431.831 4.845-4.351-2.287-4.351 2.287.831-4.845-3.52-3.431 4.864-.707z%22/%3E %3C/svg%3E")}.vectorTabs #ca-unwatch.icon a.loading,.vectorTabs #ca-watch.icon a.loading{background-image:url("https://wiki.archlinux.org/skins/Vector/images/watch-icon-loading.png?5cb92");background-image:linear-gradient(transparent,transparent),url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2216%22 height=%2216%22%3E %3Cpath fill=%22%23fff%22 stroke=%22%23c8ccd1%22 stroke-width=%22.99992%22 d=%22M8.103 1.146l2.175 4.408 4.864.707-3.52 3.431.831 4.845-4.351-2.287-4.351 2.287.831-4.845-3.52-3.431 4.864-.707z%22/%3E %3C/svg%3E");-webkit-animation:rotate 700ms infinite linear;-moz-animation:rotate 700ms infinite linear;animation:rotate 700ms infinite linear;outline:0;cursor:default;pointer-events:none;background-position:50% 60%;-webkit-transform-origin:50% 57%;transform-origin:50% 57%}.vectorTabs #ca-unwatch.icon a span,.vectorTabs #ca-watch.icon a span{display:none}#mw-navigation h2{position:absolute;top:-9999px}.mw-jump-link:not(:focus){display:block;position:absolute !important;clip:rect(1px,1px,1px,1px);width:1px;height:1px;margin:-1px;border:0;padding:0;overflow:hidden}#mw-page-base{height:5em;background-position:bottom left;background-repeat:repeat-x;background-image:url("https://wiki.archlinux.org/skins/Vector/images/page-fade.png?1d168");background-color:#f6f6f6;background-image:-webkit-linear-gradient(top,#ffffff 50%,#f6f6f6 100%);background-image:-moz-linear-gradient(top,#ffffff 50%,#f6f6f6 100%);background-image:linear-gradient(#ffffff 50%,#f6f6f6 100%);background-color:#ffffff}#mw-head-base{margin-top:-5em;margin-left:10em;height:5em}#mw-head{position:absolute;top:0;right:0;width:100%}#left-navigation{float:left;margin-left:10em;margin-top:2.5em;margin-bottom:-2.5em}#right-navigation{float:right;margin-top:2.5em}#p-logo{width:10em;height:160px}#p-logo a{display:block;width:10em;height:160px;background-repeat:no-repeat;background-position:center center;text-decoration:none}#mw-panel{font-size:inherit;position:absolute;top:0;width:10em;left:0}#mw-panel .portal{margin:0 0.6em 0 0.7em;padding:0.25em 0;direction:ltr;background-position:top left;background-repeat:no-repeat}#mw-panel .portal h3{font-size:0.75em;color:#444444;font-weight:normal;margin:0.5em 0 0 0.66666667em;padding:0.25em 0;cursor:default;border:0}#mw-panel .portal .body{margin-left:0.5em;padding-top:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIwAAAABCAAAAAAphRnkAAAAJ0lEQVQIW7XFsQEAIAyAMPD/b7uLWz8wS5youFW1UREfiIpH1Q2VBz7fGPS1dOGeAAAAAElFTkSuQmCC");background-image:url("https://wiki.archlinux.org/skins/Vector/images/portal-break.png?3ea1b")!ie;background-repeat:no-repeat}#mw-panel .portal .body ul{list-style:none none;margin:0;padding:0.3em 0 0 0}#mw-panel .portal .body li{line-height:1.125em;margin:0;padding:0.25em 0;font-size:0.75em;word-wrap:break-word}#mw-panel .portal .body li a{color:#0645ad}#mw-panel .portal .body li a:visited{color:#0b0080}#mw-panel #p-logo + .portal{background-image:none;margin-top:1em}#mw-panel #p-logo + .portal h3{display:none}#mw-panel #p-logo + .portal .body{background-image:none;margin-left:0.5em}#footer{margin-left:10em;margin-top:0;padding:0.75em;direction:ltr}#footer ul{list-style:none none;margin:0;padding:0}#footer ul li{color:#222;margin:0;padding:0;padding-top:0.5em;padding-bottom:0.5em;font-size:0.7em}#footer #footer-icons{float:right}#footer #footer-icons li{float:left;margin-left:0.5em;line-height:2em;text-align:right}#footer #footer-info li{line-height:1.4em}#footer #footer-places li{float:left;margin-right:1em;line-height:2em}.mw-parser-output .external{background-position:center right;background-repeat:no-repeat;background-image:url("https://wiki.archlinux.org/skins/Vector/images/external-link-ltr-icon.png?325de");background-image:linear-gradient(transparent,transparent),url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2212%22 height=%2212%22%3E %3Cpath fill=%22%23fff%22 stroke=%22%2336c%22 d=%22M1.5 4.518h5.982V10.5H1.5z%22/%3E %3Cpath fill=%22%2336c%22 d=%22M5.765 1H11v5.39L9.427 7.937l-1.31-1.31L5.393 9.35l-2.69-2.688 2.81-2.808L4.2 2.544z%22/%3E %3Cpath fill=%22%23fff%22 d=%22M9.995 2.004l.022 4.885L8.2 5.07 5.32 7.95 4.09 6.723l2.882-2.88-1.85-1.852z%22/%3E %3C/svg%3E");padding-right:13px}}@media screen and (min-width:982px){.mw-body,#mw-head-base,#left-navigation,#footer{margin-left:11em}.mw-body{padding:1.25em 1.5em 1.5em 1.5em}#footer{padding:1.25em}#mw-panel{padding-left:0.5em}#p-search{margin-right:1em}#p-personal{right:1em}}@media print{.toc,body{padding:10px;font-family:'Linux Libertine','Georgia','Times',serif}.printfooter,#footer,.thumb,table,ol,dl,ul,h3,h4,h5,h6{font-family:sans-serif}img{font-family:'Linux Libertine','Georgia','Times',serif}a{border-bottom:1px solid #aaa}.firstHeading{font-size:25pt;line-height:28pt;margin-bottom:20px;padding-bottom:5px}.firstHeading,h2{overflow:hidden;border-bottom:2px solid #000000}h3,h4,h5,h6{margin:30px 0 0}h2,h3,h4,h5,h6{padding:0;position:relative}h2{font-size:18pt;line-height:24pt;margin-bottom:0.25em}h3{font-size:13pt;line-height:20pt}h4,h5,h6{font-size:10pt;line-height:15pt}p{font-size:10pt;line-height:16pt;margin-top:5px;text-align:justify}p:before{content:'';display:block;overflow:hidden;width:120pt}blockquote{border-left:2px solid #000000;padding-left:20px}ol,ul{margin:10px 0 0 1.6em;padding:0}ol li,ul li{padding:2px 0;font-size:10pt}table ol li,table ul li{font-size:inherit}.toc{page-break-before:avoid;page-break-after:avoid;background:none;border:0;display:table}.toc a{border:0;font-weight:normal}.toc > ul > li{margin-bottom:4px;font-weight:bold}.toc ul{margin:0;list-style:none}.toc ul ul{padding-left:30px}.toc li.toclevel-1 > a{font-weight:bold;font-size:10pt}.mw-jump-link,.toc .tocnumber{display:none}.printfooter{margin-top:10px;border-top:3px solid #000000;padding-top:10px;font-size:10pt;clear:both}#footer{margin-top:12px;border-top:1px solid #eeeeee;padding-top:5px}#footer-info{margin:0;padding:0}#footer-info li{color:#999;list-style:none;display:block;padding-bottom:10px;font-size:10pt}#footer-info li a{color:#999 !important}#footer-info-lastmod{color:#000000;font-size:12pt;font-weight:bold}}@media screen and (max-width:720px){#mw-head{position:static !important;margin-top:0.5em}div#mw-navigation div#mw-panel{display:table;position:static;table-layout:fixed;width:100%;overflow:hidden;font-size:150%}div#mw-navigation div#mw-panel .portal{display:block;width:100%}div#mw-navigation div#mw-panel ul li{list-style:none}div#p-logo{display:none}body #footer{margin-left:0;padding-top:0}body #footer #footer-info-lastmod,body #footer #footer-info-viewcount{display:none}div#p-personal{display:table;position:relative;width:100%;top:inherit;left:inherit;right:inherit}div#p-personal ul{padding-left:0}div#right-navigation{position:absolute;top:inherit;right:0;margin-top:0;float:none}div#left-navigation{position:absolute;top:inherit;margin:0;display:block;float:none}div#p-namespaces,div#p-views,div#p-variants{position:relative;top:2.5em}div#p-namespaces{padding-left:0}div#p-cactions{top:2.5em;float:right}div#p-search{float:none;position:absolute;right:0;width:100vw;margin:0}div#simpleSearch{margin:0 3em;width:80vw;padding:0}.vectorMenu .menu{left:inherit;right:-1px}div#content{border-left:0;margin-left:0}}#archnavbar{height:40px !important;padding:10px 15px !important;background:#333 !important;border-bottom:5px #08c solid !important}#archnavbarlogo{float:left !important;margin:0 !important;padding:0 !important;height:40px !important;width:190px !important}html > body #archnavbarlogo{background:url("https://wiki.archlinux.org/extensions/ArchLinux/modules/archnavbar/archlogo.svg?29b1c") no-repeat !important;background-size:190px 40px !important}#archnavbarlogo p{margin:0 !important;padding:0 !important;text-indent:-9999px !important}#archnavbarlogo h1{margin:0 !important;padding:0 !important;text-indent:-9999px !important}#archnavbarlogo a{display:block !important;height:40px !important;width:190px !important}#archnavbar ul{display:inline !important;float:right !important;list-style:none !important;margin:0 !important;padding:0 !important}#archnavbar ul li{float:left !important;font-size:14px !important;font-family:sans-serif !important;line-height:45px !important;padding-right:15px !important;padding-left:15px !important}#archnavbar ul#archnavbarlist li a{color:#999;font-weight:bold !important;text-decoration:none !important}#archnavbar ul li a:hover{color:white !important;text-decoration:underline !important}#archnavbar ul li.anb-selected a{color:white !important}@media (max-width:600px){#anb-wiki{display:none}}@media (max-width:680px){html > body #archnavbarlogo{width:40px !important;margin-right:5px !important;background:url("https://wiki.archlinux.org/extensions/ArchLinux/modules/archnavbar/archicon.svg?0c6bc") no-repeat !important;background-size:40px 40px !important}#archnavbar ul{display:flex !important;justify-content:space-between;flex-wrap:nowrap;overflow:hidden;float:none !important}#archnavbar ul li{padding:0 !important;float:none !important}}@media (max-width:830px){#anb-home,#anb-start{display:none}html > body #archnavbarlogo{padding-right:15px !important}#archnavbar{padding-left:5px !important;padding-right:5px !important}#archnavbar ul li{padding-left:5px !important;padding-right:5px !important}}body{background:#f6f9fc}#content{background:#ffffff;border:1px solid #cccccc}#content table,#content h1,#content h2,#content h3,#content h4,#content h5,#content pre,#content code,#content tt{color:#222222}#content ul{list-style-image:none}#content table{border-collapse:collapse;padding:2px}#content td{padding:2px}#content pre{border:1px solid #bbccdd;overflow:auto;word-break:break-all;white-space:pre-wrap !important}#content pre,#content code,#content tt{background-color:#ebf1f5;font-family:monospace}#content code,#content tt{display:inline-block;padding:0 0.3em;border-width:0;border-radius:0}#footer-icons{display:none}#footer{color:#333333}#toc,.toc,.mw-warning,.toccolours{background-color:#f9faff;border:1px solid #d7dfe3}#bodyContent > div.mw-content-ltr a,#bodyContent > div.mw-content-rtl a,#wikiPreview > div.mw-content-ltr a,#wikiPreview > div.mw-content-rtl a{font-weight:bold}#bodyContent #toc a,#bodyContent .special li > a,#bodyContent .special li span a,#bodyContent #pagehistory a{font-weight:normal}#content a:not(.new),#mw-navigation li:not(.new) a:not(.new),#mw-panel li:not(.new) a:not(.new),#column-one li:not(.new) a:not(.new),#footer a:not(.new){text-decoration:none;color:#0077bb !important}#content a:not(.new):hover,#mw-navigation li:not(.new) a:not(.new):hover,#mw-panel li:not(.new) a:not(.new):hover,#column-one li:not(.new) a:not(.new):hover,#footer a:not(.new):hover{text-decoration:underline;background-color:transparent;color:#999999 !important}#content a:active,#mw-navigation li:not(.new) a:active,#mw-panel li:not(.new) a:active,#column-one li:not(.new) a:active,#footer a:active,#content a:focus,#mw-navigation li:not(.new) a:focus,#mw-panel li:not(.new) a:focus,#column-one li:not(.new) a:focus,#footer a:focus,#content a:active:hover,#mw-navigation li:not(.new) a:active:hover,#mw-panel li:not(.new) a:active:hover,#column-one li:not(.new) a:active:hover,#footer a:active:hover,#content a:focus:hover,#mw-navigation li:not(.new) a:focus:hover,#mw-panel li:not(.new) a:focus:hover,#column-one li:not(.new) a:focus:hover,#footer a:focus:hover{color:#ee9900 !important}#content a:not(.new):visited,#mw-panel li:not(.new) a:not(.new):visited,#p-navigation li:not(.new) a:not(.new):visited,#p-tb li:not(.new) a:not(.new):visited{color:#666666 !important}a.new,a.new:visited,#mw-navigation li.new a,#mw-navigation li.new a:visited{color:#bb0000 !important}.mw-body-content a.external,.mw-body-content a.extiw{background:url("https://wiki.archlinux.org/resources/src/mediawiki.skinning/images/external-ltr.png") center right no-repeat;padding-right:13px}.mw-body h1,.mw-body-content h1,.mw-body-content h2{font-family:sans-serif}div#mw-head{top:65px}div#mw-panel{top:65px}#p-logo{display:none}#mw-page-base{background:none}div.vectorTabs,div.vectorMenu{margin-top:-2px}div.vectorTabs{padding-left:0}div.vectorTabs ul,div.vectorTabs ul li{background:none}div.vectorTabs ul li{border:1px}div.vectorTabs li.selected{border:1px solid #cccccc;border-bottom-color:#ffffff;background-color:#ffffff}div.vectorTabs li.selected span{background:none}div.vectorTabs li:not(:first-child).selected{margin-left:-2px}@media screen and (max-width:720px){div#p-personal{top:unset}div#mw-panel{padding-top:0}}</style><style class="darkreader darkreader--sync" media="screen"></style>
<script async="" src="PCI%20passthrough%20via%20OVMF%20-%20ArchWiki_files/load.php"></script>
<style>
.suggestions{overflow:hidden;position:absolute;top:0;left:0;width:0;border:0;z-index:1099;padding:0;margin:-1px 0 0 0}.suggestions-special{position:relative;background-color:#fff;cursor:pointer;border:1px solid #a2a9b1;margin:0;margin-top:-2px;display:none;padding:0.25em 0.25em;line-height:1.25em}.suggestions-results{background-color:#fff;cursor:pointer;border:1px solid #a2a9b1;padding:0;margin:0}.suggestions-result{color:#000;margin:0;line-height:1.5em;padding:0.01em 0.25em;text-align:left; overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.suggestions-result-current{background-color:#2a4b8d;color:#fff}.suggestions-special .special-label{color:#72777d;text-align:left}.suggestions-special .special-query{color:#000;font-style:italic;text-align:left}.suggestions-special .special-hover{background-color:#c8ccd1}.suggestions-result-current .special-label,.suggestions-result-current .special-query{color:#fff}.highlight{font-weight:bold}
@media screen {
	.tochidden,.toctoggle{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.toctoggle{font-size:94%}}
@media print {
	.toc.tochidden,.toctoggle{display:none}}</style><style class="darkreader darkreader--sync" media="screen"></style><style>
.suggestions a.mw-searchSuggest-link,.suggestions a.mw-searchSuggest-link:hover,.suggestions a.mw-searchSuggest-link:active,.suggestions a.mw-searchSuggest-link:focus{color:#000;text-decoration:none}.suggestions-result-current a.mw-searchSuggest-link,.suggestions-result-current a.mw-searchSuggest-link:hover,.suggestions-result-current a.mw-searchSuggest-link:active,.suggestions-result-current a.mw-searchSuggest-link:focus{color:#fff}.suggestions a.mw-searchSuggest-link .special-query{ overflow:hidden;text-overflow:ellipsis;white-space:nowrap}</style><style class="darkreader darkreader--sync" media="screen"></style><meta name="ResourceLoaderDynamicStyles" content="">
<link rel="stylesheet" href="PCI%20passthrough%20via%20OVMF%20-%20ArchWiki_files/load_002.css"><style class="darkreader darkreader--cors" media="screen">pre,.mw-code{white-space:pre}#bodyContent a.external[href ^="http://wiki.archlinux.org"],#bodyContent a.external[href ^="https://wiki.archlinux.org"]{background:none;padding-right:0}span.archwiki-template-pkg,span.archwiki-template-man{font-family:monospace}div.archwiki-template-box{padding:5px;border:thin solid black;margin:0.5em 0;overflow:hidden}div.archwiki-template-box.archwiki-template-box-note{background-color:#ddf;border-color:#bbd}div.archwiki-template-box.archwiki-template-box-warning{background-color:#fdd;border-color:#dbb}div.archwiki-template-box.archwiki-template-box-tip{background-color:#dfd;border-color:#bdb}div.archwiki-template-message{position:relative;overflow:hidden;min-height:4.6em;margin-bottom:1em;background-color:#f9faff;border:1px solid #d7dfe3;padding:0 100px;text-align:center}div.archwiki-template-message > p > a{display:block;position:absolute;top:5px}div.archwiki-template-message > p > a:first-of-type{left:26px}div.archwiki-template-message > p > a:last-of-type{right:26px}div.archwiki-template-message > div{font-size:90%}div.archwiki-template-message ul,div.archwiki-template-message ol{text-align:left}div.archwiki-template-meta-related-articles-start{float:right;clear:right;width:25%;margin:0 0 0.5em 0.5em}div.archwiki-template-meta-related-articles-start > p{background:#333;color:white;padding:0.2em;border-bottom:5px #08c solid;margin:0;text-align:center;font-weight:bold}div.archwiki-template-meta-related-articles-start > ul{list-style-type:none;list-style-image:none;margin:0;padding:0.3em}div.archwiki-template-meta-related-articles-start > ul > li{padding:0.4em 0;line-height:1}@media screen and (min-width:721px){div.archwiki-main-page-columns{column-count:2}div.archwiki-main-page-columns > *{page-break-inside:avoid;display:inline-block;width:100%}}</style><style class="darkreader darkreader--sync" media="screen"></style>
<meta name="generator" content="MediaWiki 1.33.1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="https://wiki.archlinux.org/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="https://wiki.archlinux.org/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="https://wiki.archlinux.org/index.php?title=Special:RecentChanges&amp;feed=atom">
<!--[if lt IE 9]><script src="/load.php?lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=vector&amp;sync=1"></script><![endif]-->
<style class="darkreader darkreader--override" media="screen">.vimvixen-hint {
    background-color: #7b5300 !important;
    border-color: #d8b013 !important;
    color: #f3e8c8 !important;
}
::placeholder {
    opacity: 0.5 !important;
}</style></head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-PCI_passthrough_via_OVMF rootpage-PCI_passthrough_via_OVMF skin-vector action-view"><div id="archnavbar" class="noprint">
    <div id="archnavbarlogo">
        <p><a id="logo" href="https://www.archlinux.org/"></a></p>
    </div>
    <div id="archnavbarmenu">
        <ul id="archnavbarlist">
                        <li id="anb-home"><a href="https://www.archlinux.org/">Home</a></li>            <li id="anb-packages"><a href="https://www.archlinux.org/packages/">Packages</a></li>            <li id="anb-forums"><a href="https://bbs.archlinux.org/">Forums</a></li>            <li id="anb-wiki" class="anb-selected"><a href="https://wiki.archlinux.org/">Wiki</a></li>            <li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li>            <li id="anb-security"><a href="https://security.archlinux.org/">Security</a></li>            <li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li>            <li id="anb-download"><a href="https://www.archlinux.org/download/">Download</a></li>        </ul>
    </div>
</div>

<div id="mw-page-base" class="noprint"></div>
<div id="mw-head-base" class="noprint"></div>
<div id="content" class="mw-body" role="main">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading" class="firstHeading" lang="en">PCI passthrough via OVMF</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" dir="ltr" class="mw-content-ltr" lang="en"><div class="mw-parser-output"><div class="archwiki-template-meta-related-articles-start"><p>Related articles</p><ul>
<li><a href="https://wiki.archlinux.org/index.php/Intel_GVT-g" title="Intel GVT-g">Intel GVT-g</a></li>
</ul></div>
<p>The Open Virtual Machine Firmware (<a rel="nofollow" class="external text" href="https://github.com/tianocore/tianocore.github.io/wiki/OVMF">OVMF</a>) is a project to enable UEFI support for virtual machines. Starting with Linux 3.9 and recent versions of <a href="https://wiki.archlinux.org/index.php/QEMU" title="QEMU">QEMU</a>,
 it is now possible to passthrough a graphics card, offering the VM 
native graphics performance which is useful for graphic-intensive tasks.
</p><p>Provided you have a desktop computer with a spare GPU you can 
dedicate to the host (be it an integrated GPU or an old OEM card, the 
brands do not even need to match) and that your hardware supports it 
(see <a href="#Prerequisites">#Prerequisites</a>), it is possible to 
have a VM of any OS with its own dedicated GPU and near-native 
performance. For more information on techniques see the background <a rel="nofollow" class="external text" href="https://www.linux-kvm.org/images/b/b3/01x09b-VFIOandYou-small.pdf">presentation (pdf)</a>. 
</p>
<div id="toc" class="toc"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" dir="ltr" lang="en"><h2>Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Prerequisites"><span class="tocnumber">1</span> <span class="toctext">Prerequisites</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Setting_up_IOMMU"><span class="tocnumber">2</span> <span class="toctext">Setting up IOMMU</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Enabling_IOMMU"><span class="tocnumber">2.1</span> <span class="toctext">Enabling IOMMU</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Ensuring_that_the_groups_are_valid"><span class="tocnumber">2.2</span> <span class="toctext">Ensuring that the groups are valid</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Gotchas"><span class="tocnumber">2.3</span> <span class="toctext">Gotchas</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#Plugging_your_guest_GPU_in_an_unisolated_CPU-based_PCIe_slot"><span class="tocnumber">2.3.1</span> <span class="toctext">Plugging your guest GPU in an unisolated CPU-based PCIe slot</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Isolating_the_GPU"><span class="tocnumber">3</span> <span class="toctext">Isolating the GPU</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#With_vfio-pci_loaded_as_a_module"><span class="tocnumber">3.1</span> <span class="toctext">With vfio-pci loaded as a module</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#With_vfio-pci_built_into_the_kernel"><span class="tocnumber">3.2</span> <span class="toctext">With vfio-pci built into the kernel</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Verifying_that_the_configuration_worked"><span class="tocnumber">3.3</span> <span class="toctext">Verifying that the configuration worked</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#Setting_up_an_OVMF-based_guest_VM"><span class="tocnumber">4</span> <span class="toctext">Setting up an OVMF-based guest VM</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#Configuring_libvirt"><span class="tocnumber">4.1</span> <span class="toctext">Configuring libvirt</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Setting_up_the_guest_OS"><span class="tocnumber">4.2</span> <span class="toctext">Setting up the guest OS</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Attaching_the_PCI_devices"><span class="tocnumber">4.3</span> <span class="toctext">Attaching the PCI devices</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Passing_keyboard/mouse_via_Evdev"><span class="tocnumber">4.4</span> <span class="toctext">Passing keyboard/mouse via Evdev</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Gotchas_2"><span class="tocnumber">4.5</span> <span class="toctext">Gotchas</span></a>
<ul>
<li class="toclevel-3 tocsection-17"><a href="#Using_a_non-EFI_image_on_an_OVMF-based_VM"><span class="tocnumber">4.5.1</span> <span class="toctext">Using a non-EFI image on an OVMF-based VM</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-18"><a href="#Performance_tuning"><span class="tocnumber">5</span> <span class="toctext">Performance tuning</span></a>
<ul>
<li class="toclevel-2 tocsection-19"><a href="#CPU_pinning"><span class="tocnumber">5.1</span> <span class="toctext">CPU pinning</span></a>
<ul>
<li class="toclevel-3 tocsection-20"><a href="#CPU_topology"><span class="tocnumber">5.1.1</span> <span class="toctext">CPU topology</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="#XML_examples"><span class="tocnumber">5.1.2</span> <span class="toctext">XML examples</span></a>
<ul>
<li class="toclevel-4 tocsection-22"><a href="#4c/1t_CPU_w/o_Hyperthreading_Example"><span class="tocnumber">5.1.2.1</span> <span class="toctext">4c/1t CPU w/o Hyperthreading Example</span></a></li>
<li class="toclevel-4 tocsection-23"><a href="#4c/2t_Intel_CPU_pinning_example"><span class="tocnumber">5.1.2.2</span> <span class="toctext">4c/2t Intel CPU pinning example</span></a></li>
<li class="toclevel-4 tocsection-24"><a href="#4c/2t_AMD_CPU_example_(Before_ComboPi_AGESA)"><span class="tocnumber">5.1.2.3</span> <span class="toctext">4c/2t AMD CPU example (Before ComboPi AGESA)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-25"><a href="#Huge_memory_pages"><span class="tocnumber">5.2</span> <span class="toctext">Huge memory pages</span></a>
<ul>
<li class="toclevel-3 tocsection-26"><a href="#Transparent_huge_pages"><span class="tocnumber">5.2.1</span> <span class="toctext">Transparent huge pages</span></a></li>
<li class="toclevel-3 tocsection-27"><a href="#Static_huge_pages"><span class="tocnumber">5.2.2</span> <span class="toctext">Static huge pages</span></a></li>
<li class="toclevel-3 tocsection-28"><a href="#Dynamic_huge_pages"><span class="tocnumber">5.2.3</span> <span class="toctext">Dynamic huge pages</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-29"><a href="#CPU_frequency_governor"><span class="tocnumber">5.3</span> <span class="toctext">CPU frequency governor</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#Isolating_pinned_CPUs"><span class="tocnumber">5.4</span> <span class="toctext">Isolating pinned CPUs</span></a>
<ul>
<li class="toclevel-3 tocsection-31"><a href="#With_isolcpus_kernel_parameter"><span class="tocnumber">5.4.1</span> <span class="toctext">With isolcpus kernel parameter</span></a></li>
<li class="toclevel-3 tocsection-32"><a href="#Dynamically_isolating_CPUs"><span class="tocnumber">5.4.2</span> <span class="toctext">Dynamically isolating CPUs</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-33"><a href="#Improving_performance_on_AMD_CPUs"><span class="tocnumber">5.5</span> <span class="toctext">Improving performance on AMD CPUs</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="#Further_tuning"><span class="tocnumber">5.6</span> <span class="toctext">Further tuning</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-35"><a href="#Special_procedures"><span class="tocnumber">6</span> <span class="toctext">Special procedures</span></a>
<ul>
<li class="toclevel-2 tocsection-36"><a href="#Using_identical_guest_and_host_GPUs"><span class="tocnumber">6.1</span> <span class="toctext">Using identical guest and host GPUs</span></a>
<ul>
<li class="toclevel-3 tocsection-37"><a href="#Script_variants"><span class="tocnumber">6.1.1</span> <span class="toctext">Script variants</span></a>
<ul>
<li class="toclevel-4 tocsection-38"><a href="#Passthrough_all_GPUs_but_the_boot_GPU"><span class="tocnumber">6.1.1.1</span> <span class="toctext">Passthrough all GPUs but the boot GPU</span></a></li>
<li class="toclevel-4 tocsection-39"><a href="#Passthrough_selected_GPU"><span class="tocnumber">6.1.1.2</span> <span class="toctext">Passthrough selected GPU</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-40"><a href="#Script_installation"><span class="tocnumber">6.1.2</span> <span class="toctext">Script installation</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-41"><a href="#Passing_the_boot_GPU_to_the_guest"><span class="tocnumber">6.2</span> <span class="toctext">Passing the boot GPU to the guest</span></a></li>
<li class="toclevel-2 tocsection-42"><a href="#Using_Looking_Glass_to_stream_guest_screen_to_the_host"><span class="tocnumber">6.3</span> <span class="toctext">Using Looking Glass to stream guest screen to the host</span></a>
<ul>
<li class="toclevel-3 tocsection-43"><a href="#Adding_IVSHMEM_Device_to_VM"><span class="tocnumber">6.3.1</span> <span class="toctext">Adding IVSHMEM Device to VM</span></a></li>
<li class="toclevel-3 tocsection-44"><a href="#Installing_the_IVSHMEM_Host_to_Windows_guest"><span class="tocnumber">6.3.2</span> <span class="toctext">Installing the IVSHMEM Host to Windows guest</span></a></li>
<li class="toclevel-3 tocsection-45"><a href="#Getting_a_client"><span class="tocnumber">6.3.3</span> <span class="toctext">Getting a client</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-46"><a href="#Swap_peripherals_to_and_from_the_Host"><span class="tocnumber">6.4</span> <span class="toctext">Swap peripherals to and from the Host</span></a></li>
<li class="toclevel-2 tocsection-47"><a href="#Bypassing_the_IOMMU_groups_(ACS_override_patch)"><span class="tocnumber">6.5</span> <span class="toctext">Bypassing the IOMMU groups (ACS override patch)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-48"><a href="#Plain_QEMU_without_libvirt"><span class="tocnumber">7</span> <span class="toctext">Plain QEMU without libvirt</span></a></li>
<li class="toclevel-1 tocsection-49"><a href="#Passing_though_other_devices"><span class="tocnumber">8</span> <span class="toctext">Passing though other devices</span></a>
<ul>
<li class="toclevel-2 tocsection-50"><a href="#USB_controller"><span class="tocnumber">8.1</span> <span class="toctext">USB controller</span></a></li>
<li class="toclevel-2 tocsection-51"><a href="#Passing_VM_audio_to_host_via_PulseAudio"><span class="tocnumber">8.2</span> <span class="toctext">Passing VM audio to host via PulseAudio</span></a>
<ul>
<li class="toclevel-3 tocsection-52"><a href="#QEMU_3.0_audio_changes"><span class="tocnumber">8.2.1</span> <span class="toctext">QEMU 3.0 audio changes</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-53"><a href="#Passing_VM_audio_to_host_via_Scream_and_IVSHMEM"><span class="tocnumber">8.3</span> <span class="toctext">Passing VM audio to host via Scream and IVSHMEM</span></a>
<ul>
<li class="toclevel-3 tocsection-54"><a href="#Adding_the_IVSHMEM"><span class="tocnumber">8.3.1</span> <span class="toctext">Adding the IVSHMEM</span></a></li>
<li class="toclevel-3 tocsection-55"><a href="#Configuring_the_Windows_guest"><span class="tocnumber">8.3.2</span> <span class="toctext">Configuring the Windows guest</span></a></li>
<li class="toclevel-3 tocsection-56"><a href="#Configuring_the_host"><span class="tocnumber">8.3.3</span> <span class="toctext">Configuring the host</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-57"><a href="#Physical_disk/partition"><span class="tocnumber">8.4</span> <span class="toctext">Physical disk/partition</span></a></li>
<li class="toclevel-2 tocsection-58"><a href="#Gotchas_3"><span class="tocnumber">8.5</span> <span class="toctext">Gotchas</span></a>
<ul>
<li class="toclevel-3 tocsection-59"><a href="#Passing_through_a_device_that_does_not_support_resetting"><span class="tocnumber">8.5.1</span> <span class="toctext">Passing through a device that does not support resetting</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-60"><a href="#Complete_setups_and_examples"><span class="tocnumber">9</span> <span class="toctext">Complete setups and examples</span></a></li>
<li class="toclevel-1 tocsection-61"><a href="#Troubleshooting"><span class="tocnumber">10</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-62"><a href="#QEMU_4.0:_Unable_to_load_graphics_drivers/BSOD/Graphics_stutter_after_driver_install_using_Q35"><span class="tocnumber">10.1</span> <span class="toctext">QEMU 4.0: Unable to load graphics drivers/BSOD/Graphics stutter after driver install using Q35</span></a></li>
<li class="toclevel-2 tocsection-63"><a href="#&quot;Error_43:_Driver_failed_to_load&quot;_on_Nvidia_GPUs_passed_to_Windows_VMs"><span class="tocnumber">10.2</span> <span class="toctext">"Error 43: Driver failed to load" on Nvidia GPUs passed to Windows VMs</span></a></li>
<li class="toclevel-2 tocsection-64"><a href="#&quot;BAR_3:_cannot_reserve_[mem]&quot;_error_in_dmesg_after_starting_VM"><span class="tocnumber">10.3</span> <span class="toctext">"BAR 3: cannot reserve [mem]" error in dmesg after starting VM</span></a></li>
<li class="toclevel-2 tocsection-65"><a href="#UEFI_(OVMF)_compatibility_in_VBIOS"><span class="tocnumber">10.4</span> <span class="toctext">UEFI (OVMF) compatibility in VBIOS</span></a></li>
<li class="toclevel-2 tocsection-66"><a href="#Slowed_down_audio_pumped_through_HDMI_on_the_video_card"><span class="tocnumber">10.5</span> <span class="toctext">Slowed down audio pumped through HDMI on the video card</span></a></li>
<li class="toclevel-2 tocsection-67"><a href="#No_HDMI_audio_output_on_host_when_intel_iommu_is_enabled"><span class="tocnumber">10.6</span> <span class="toctext">No HDMI audio output on host when intel_iommu is enabled</span></a></li>
<li class="toclevel-2 tocsection-68"><a href="#X_does_not_start_after_enabling_vfio_pci"><span class="tocnumber">10.7</span> <span class="toctext">X does not start after enabling vfio_pci</span></a></li>
<li class="toclevel-2 tocsection-69"><a href="#Chromium_ignores_integrated_graphics_for_acceleration"><span class="tocnumber">10.8</span> <span class="toctext">Chromium ignores integrated graphics for acceleration</span></a></li>
<li class="toclevel-2 tocsection-70"><a href="#VM_only_uses_one_core"><span class="tocnumber">10.9</span> <span class="toctext">VM only uses one core</span></a></li>
<li class="toclevel-2 tocsection-71"><a href="#Passthrough_seems_to_work_but_no_output_is_displayed"><span class="tocnumber">10.10</span> <span class="toctext">Passthrough seems to work but no output is displayed</span></a></li>
<li class="toclevel-2 tocsection-72"><a href="#virt-manager_has_permission_issues"><span class="tocnumber">10.11</span> <span class="toctext">virt-manager has permission issues</span></a></li>
<li class="toclevel-2 tocsection-73"><a href="#Host_lockup_after_VM_shutdown"><span class="tocnumber">10.12</span> <span class="toctext">Host lockup after VM shutdown</span></a></li>
<li class="toclevel-2 tocsection-74"><a href="#Host_lockup_if_guest_is_left_running_during_sleep"><span class="tocnumber">10.13</span> <span class="toctext">Host lockup if guest is left running during sleep</span></a></li>
<li class="toclevel-2 tocsection-75"><a href="#Cannot_boot_after_upgrading_ovmf"><span class="tocnumber">10.14</span> <span class="toctext">Cannot boot after upgrading ovmf</span></a></li>
<li class="toclevel-2 tocsection-76"><a href="#QEMU_via_cli_pulseaudio_stuttering/delay"><span class="tocnumber">10.15</span> <span class="toctext">QEMU via cli pulseaudio stuttering/delay</span></a></li>
<li class="toclevel-2 tocsection-77"><a href="#Bluescreen_at_boot_since_Windows_10_1803"><span class="tocnumber">10.16</span> <span class="toctext">Bluescreen at boot since Windows 10 1803</span></a></li>
<li class="toclevel-2 tocsection-78"><a href="#AMD_Ryzen_/_BIOS_updates_(AGESA)_yields_&quot;Error:_internal_error:_Unknown_PCI_header_type_127&quot;"><span class="tocnumber">10.17</span> <span class="toctext">AMD Ryzen / BIOS updates (AGESA) yields "Error: internal error: Unknown PCI header type 127"</span></a></li>
<li class="toclevel-2 tocsection-79"><a href="#Host_crashes_when_hotplugging_Nvidia_card_with_USB"><span class="tocnumber">10.18</span> <span class="toctext">Host crashes when hotplugging Nvidia card with USB</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-80"><a href="#See_also"><span class="tocnumber">11</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Prerequisites">Prerequisites</span></h2>
<p>A VGA Passthrough relies on a number of technologies that are not 
ubiquitous as of today and might not be available on your hardware. You 
will not be able to do this on your machine unless the following 
requirements are met&nbsp;:
</p>
<ul><li>Your CPU must support hardware virtualization (for kvm) and IOMMU (for the passthrough itself)
<ul><li><a rel="nofollow" class="external text" href="https://ark.intel.com/Search/FeatureFilter?productType=873&amp;0_VTD=True">List of compatible Intel CPUs (Intel VT-x and Intel VT-d)</a></li>
<li>All AMD CPUs from the Bulldozer generation and up (including Zen) should be compatible.
<ul><li>CPUs from the K10 generation (2007) do not have an IOMMU, so you <b>need</b> to have a motherboard with a <a rel="nofollow" class="external text" href="https://support.amd.com/TechDocs/43403.pdf#page=18">890FX</a> or <a rel="nofollow" class="external text" href="https://support.amd.com/TechDocs/48691.pdf#page=21">990FX</a> chipset to make it work, as those have their own IOMMU.</li></ul></li></ul></li>
<li>Your motherboard must also support IOMMU
<ul><li>Both the chipset and the BIOS must support it. It is not always 
easy to tell at a glance whether or not this is the case, but there is a
 fairly comprehensive list on the matter on the <a rel="nofollow" class="external text" href="https://wiki.xen.org/wiki/VTd_HowTo">Xen wiki</a> as well as <a href="https://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware" class="extiw" title="wikipedia:List of IOMMU-supporting hardware">Wikipedia:List of IOMMU-supporting hardware</a>.</li></ul></li>
<li>Your guest GPU ROM must support UEFI.
<ul><li>If you can find <a rel="nofollow" class="external text" href="https://www.techpowerup.com/vgabios/">any ROM in this list</a>
 that applies to your specific GPU and is said to support UEFI, you are 
generally in the clear. All GPUs from 2012 and later should support 
this, as Microsoft made UEFI a requirement for devices to be marketed as
 compatible with Windows 8.</li></ul></li></ul>
<p>You will probably want to have a spare monitor or one with multiple 
input ports connected to different GPUs (the passthrough GPU will not 
display anything if there is no screen plugged in and using a VNC or 
Spice connection will not help your performance), as well as a mouse and
 a keyboard you can pass to your VM. If anything goes wrong, you will at
 least have a way to control your host machine this way.
</p>
<h2><span class="mw-headline" id="Setting_up_IOMMU">Setting up IOMMU</span></h2>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> 
<ul><li>IOMMU is a generic name for Intel VT-d and AMD-Vi.</li>
<li>VT-d stands for <i>Intel Virtualization Technology for Directed I/O</i> and should not be confused with VT-x <i>Intel Virtualization Technology</i>.
 VT-x allows one hardware platform to function as multiple virtual 
platforms while VT-d improves security and reliability of the systems 
and also improves performance of I/O devices in virtualized 
environments.</li></ul>
</div>
<p>Using IOMMU opens to features like PCI passthrough and memory protection from faulty or malicious devices, see <a href="https://en.wikipedia.org/wiki/Input-output_memory_management_unit#Advantages" class="extiw" title="wikipedia:Input-output memory management unit">Wikipedia:Input-output memory management unit#Advantages</a> and <a rel="nofollow" class="external text" href="https://www.quora.com/Memory-Management-computer-programming/Could-you-explain-IOMMU-in-plain-English">Memory Management (computer programming): Could you explain IOMMU in plain English?</a>.
</p>
<h3><span class="mw-headline" id="Enabling_IOMMU">Enabling IOMMU</span></h3>
<p>Ensure that AMD-Vi/Intel VT-d is supported by the CPU and enabled in 
the BIOS settings. Both normally show up alongside other CPU features 
(meaning they could be in an overclocking-related menu) either with 
their actual names ("VT-d" or "AMD-Vi") or in more ambiguous terms such 
as "Virtualization technology", which may or may not be explained in the
 manual.
</p><p>Enable IOMMU support by setting the correct <a href="https://wiki.archlinux.org/index.php/Kernel_parameter" class="mw-redirect" title="Kernel parameter">kernel parameter</a> depending on the type of CPU in use:
</p>
<ul><li>For Intel CPUs (VT-d) set <code>intel_iommu=on</code></li>
<li>For AMD CPUs (AMD-Vi) set <code>amd_iommu=on</code></li></ul>
<p>You should also append the <code>iommu=pt</code> parameter. This will prevent Linux from touching devices which cannot be passed through.
</p><p>After rebooting, check dmesg to confirm that IOMMU has been correctly enabled:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">dmesg | grep -i -e DMAR -e IOMMU</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[    0.000000] ACPI: DMAR 0x00000000BDCB1CB0 0000B8 (v01 INTEL  BDW      00000001 INTL 00000001)
[    0.000000] Intel-IOMMU: enabled
[    0.028879] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020660462 ecap f0101a
[    0.028883] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap d2008c20660462 ecap f010da
[    0.028950] IOAPIC id 8 under DRHD base  0xfed91000 IOMMU 1
[    0.536212] DMAR: No ATSR found
[    0.536229] IOMMU 0 0xfed90000: using Queued invalidation
[    0.536230] IOMMU 1 0xfed91000: using Queued invalidation
[    0.536231] IOMMU: Setting RMRR:
[    0.536241] IOMMU: Setting identity map for device 0000:00:02.0 [0xbf000000 - 0xcf1fffff]
[    0.537490] IOMMU: Setting identity map for device 0000:00:14.0 [0xbdea8000 - 0xbdeb6fff]
[    0.537512] IOMMU: Setting identity map for device 0000:00:1a.0 [0xbdea8000 - 0xbdeb6fff]
[    0.537530] IOMMU: Setting identity map for device 0000:00:1d.0 [0xbdea8000 - 0xbdeb6fff]
[    0.537543] IOMMU: Prepare 0-16MiB unity mapping for LPC
[    0.537549] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]
[    2.182790] [drm] DMAR active, disabling use of stolen memory
</pre>
<h3><span class="mw-headline" id="Ensuring_that_the_groups_are_valid">Ensuring that the groups are valid</span></h3>
<p>The following script should allow you to see how your various PCI 
devices are mapped to IOMMU groups. If it does not return anything, you 
either have not enabled IOMMU support properly or your hardware does not
 support it.
</p>
<pre>#!/bin/bash
shopt -s nullglob
for g in /sys/kernel/iommu_groups/*; do
    echo "IOMMU Group ${g##*/}:"
    for d in $g/devices/*; do
        echo -e "\t$(lspci -nns ${d##*/})"
    done;
done;
</pre>
<p>Example output:
</p>
<pre>IOMMU Group 1:
	00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor PCI Express Root Port [8086:0151] (rev 09)
IOMMU Group 2:
	00:14.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB xHCI Host Controller [8086:0e31] (rev 04)
IOMMU Group 4:
	00:1a.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #2 [8086:0e2d] (rev 04)
IOMMU Group 10:
	00:1d.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #1 [8086:0e26] (rev 04)
IOMMU Group 13:
	06:00.0 VGA compatible controller: NVIDIA Corporation GM204 [GeForce GTX 970] [10de:13c2] (rev a1)
	06:00.1 Audio device: NVIDIA Corporation GM204 High Definition Audio Controller [10de:0fbb] (rev a1)
</pre>
<p>An IOMMU group is the smallest set of physical devices that can be 
passed to a virtual machine. For instance, in the example above, both 
the GPU in 06:00.0 and its audio controller in 6:00.1 belong to IOMMU 
group 13 and can only be passed together. The frontal USB controller, 
however, has its own group (group 2) which is separate from both the USB
 expansion controller (group 10) and the rear USB controller (group 4), 
meaning that <a href="#USB_controller">any of them could be passed to a VM without affecting the others</a>.
</p>
<h3><span class="mw-headline" id="Gotchas">Gotchas</span></h3>
<h4><span class="mw-headline" id="Plugging_your_guest_GPU_in_an_unisolated_CPU-based_PCIe_slot">Plugging your guest GPU in an unisolated CPU-based PCIe slot</span></h4>
<p>Not all PCI-E slots are the same. Most motherboards have PCIe slots 
provided by both the CPU and the PCH. Depending on your CPU, it is 
possible that your processor-based PCIe slot does not support isolation 
properly, in which case the PCI slot itself will appear to be grouped 
with the device that is connected to it.
</p>
<pre>IOMMU Group 1:
	 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor PCI Express Root Port (rev 09)
	 01:00.0 VGA compatible controller: NVIDIA Corporation GM107 [GeForce GTX 750] (rev a2)
	 01:00.1 Audio device: NVIDIA Corporation Device 0fbc (rev a1)
</pre>
<p>This is fine so long as only your guest GPU is included in here, such
 as above. Depending on what is plugged in to your other PCIe slots and 
whether they are allocated to your CPU or your PCH, you may find 
yourself with additional devices within the same group, which would 
force you to pass those as well. If you are ok with passing everything 
that is in there to your VM, you are free to continue. Otherwise, you 
will either need to try and plug your GPU in your other PCIe slots (if 
you have any) and see if those provide isolation from the rest or to 
install the ACS override patch, which comes with its own drawbacks. See <a href="#Bypassing_the_IOMMU_groups_(ACS_override_patch)">#Bypassing the IOMMU groups (ACS override patch)</a> for more information.
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong>
 If they are grouped with other devices in this manner, pci root ports 
and bridges should neither be bound to vfio at boot, nor be added to the
 VM.</div>
<h2><span class="mw-headline" id="Isolating_the_GPU">Isolating the GPU</span></h2>
<p>In order to assign a device to a virtual machine, this device and all
 those sharing the same IOMMU group must have their driver replaced by a
 stub driver or a VFIO driver in order to prevent the host machine from 
interacting with them. In the case of most devices, this can be done on 
the fly right before the VM starts.
</p><p>However, due to their size and complexity, GPU drivers do not 
tend to support dynamic rebinding very well, so you cannot just have 
some GPU you use on the host be transparently passed to a VM without 
having both drivers conflict with each other. Because of this, it is 
generally advised to bind those placeholder drivers manually before 
starting the VM, in order to stop other drivers from attempting to claim
 it.
</p><p>The following section details how to configure a GPU so those 
placeholder drivers are bound early during the boot process, which makes
 said device inactive until a VM claims it or the driver is switched 
back. This is the preferred method, considering it has less caveats than
 switching drivers once the system is fully online.
</p>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong>
 Once you reboot after this procedure, whatever GPU you have configured 
will no longer be usable on the host until you reverse the manipulation.
 Make sure the GPU you intend to use on the host is properly configured 
before doing this - your motherboard should be set to display using the 
host GPU.</div>
<p>Starting with Linux 4.1, the kernel includes vfio-pci. This is a VFIO
 driver, meaning it fulfills the same role as pci-stub did, but it can 
also control devices to an extent, such as by switching them into their 
D3 state when they are not in use.
</p><p>Vfio-pci normally targets PCI devices by ID, meaning you only 
need to specify the IDs of the devices you intend to passthrough. For 
the following IOMMU group, you would want to bind vfio-pci with <code>10de:13c2</code> and <code>10de:0fbb</code>, which will be used as example values for the rest of this section.
</p>
<pre>IOMMU Group 13:
	 06:00.0 VGA compatible controller: NVIDIA Corporation GM204 [GeForce GTX 970] [10de:13c2] (rev a1)
	 06:00.1 Audio device: NVIDIA Corporation GM204 High Definition Audio Controller [10de:0fbb] (rev a1)}}
</pre>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> 
<ul><li>You cannot specify which device to isolate using vendor-device 
ID pairs if the host GPU and the guest GPU share the same pair 
(i.e&nbsp;: if both are the same model). If this is your case, read <a href="#Using_identical_guest_and_host_GPUs">#Using identical guest and host GPUs</a> instead.</li>
<li>If, as noted in <a href="#Plugging_your_guest_GPU_in_an_unisolated_CPU-based_PCIe_slot">#Plugging your guest GPU in an unisolated CPU-based PCIe slot</a>, your pci root port is part of your IOMMU group, you <b>must not</b> pass its ID to <code>vfio-pci</code>,
 as it needs to remain attached to the host to function properly. Any 
other device within that group, however, should be left for <code>vfio-pci</code> to bind with.</li></ul>
</div>
<h3><span class="mw-headline" id="With_vfio-pci_loaded_as_a_module">With vfio-pci loaded as a module</span></h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=linux">linux</a></span>
 kernel does not include vfio-pci as a built-in module and therefore 
needs to be loaded en configured separately like so. 
First, the vendor-device ID pairs must be specified as default 
parameters passed to vfio-pci whenever it is inserted into the kernel.
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">/etc/modprobe.d/vfio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options vfio-pci ids=10de:13c2,10de:0fbb</pre>
<p>This, however, does not guarantee that vfio-pci will be loaded before
 other graphics drivers. To ensure that, we need to statically bind it 
in the kernel image alongside with its dependencies. That means adding, 
in this order, <code>vfio_pci</code>, <code>vfio</code>, <code>vfio_iommu_type1</code>, and <code>vfio_virqfd</code> to <a href="https://wiki.archlinux.org/index.php/Mkinitcpio" title="Mkinitcpio">mkinitcpio</a>:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">MODULES=(... vfio_pci vfio vfio_iommu_type1 vfio_virqfd ...)</pre>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> If you also have another driver loaded this way for <a href="https://wiki.archlinux.org/index.php/Kernel_mode_setting#Early_KMS_start" title="Kernel mode setting">early modesetting</a> (such as <code>nouveau</code>, <code>radeon</code>, <code>amdgpu</code>, <code>i915</code>, etc.), all of the aforementioned VFIO modules must precede it.</div>
<p>Also, ensure that the modconf hook is included in the HOOKS list of <code>mkinitcpio.conf</code>:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">HOOKS=(... modconf ...)</pre>
<p>Since new modules have been added to the initramfs configuration, you must <a href="https://wiki.archlinux.org/index.php/Regenerate_the_initramfs" class="mw-redirect" title="Regenerate the initramfs">regenerate the initramfs</a>. Should you change the IDs of the devices in <code>/etc/modprobe.d/vfio.conf</code>,
 you will also have to regenerate it, as those parameters must be 
specified in the initramfs to be known during the early boot stages.
</p>
<h3><span class="mw-headline" id="With_vfio-pci_built_into_the_kernel">With vfio-pci built into the kernel</span></h3>
<p>If your kernel comes with the vfio-pci module built in, as opposed to
 it being a module that needs to be loaded separately. All that should 
be required to isolate the GPU is to pass the device IDs as <a href="https://wiki.archlinux.org/index.php/Kernel_parameters" title="Kernel parameters">kernel parameters</a> like so:
</p>
<pre>vfio-pci.ids=10de:13c2,10de:0fbb
</pre>
<h3><span class="mw-headline" id="Verifying_that_the_configuration_worked">Verifying that the configuration worked</span></h3>
<p>Reboot and verify that vfio-pci has loaded properly and that it is now bound to the right devices.
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ dmesg | grep -i vfio</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[    0.329224] VFIO - User Level meta-driver version: 0.3
[    0.341372] vfio_pci: add [10de:13c2[ffff:ffff]] class 0x000000/00000000
[    0.354704] vfio_pci: add [10de:0fbb[ffff:ffff]] class 0x000000/00000000
[    2.061326] vfio-pci 0000:06:00.0: enabling device (0100 -&gt; 0103)
</pre>
<p>It is not necessary for all devices (or even expected device) from <code>vfio.conf</code>
 to be in dmesg output. Sometimes a device does not appear in output at 
boot but actually is able to be visible and operatable in guest VM.
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ lspci -nnk -d 10de:13c2</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">06:00.0 VGA compatible controller: NVIDIA Corporation GM204 [GeForce GTX 970] [10de:13c2] (rev a1)
	Kernel driver in use: vfio-pci
	Kernel modules: nouveau nvidia
</pre>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ lspci -nnk -d 10de:0fbb</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">06:00.1 Audio device: NVIDIA Corporation GM204 High Definition Audio Controller [10de:0fbb] (rev a1)
	Kernel driver in use: vfio-pci
	Kernel modules: snd_hda_intel
</pre>
<h2><span class="mw-headline" id="Setting_up_an_OVMF-based_guest_VM">Setting up an OVMF-based guest VM</span></h2>
<p>OVMF is an open-source UEFI firmware for QEMU virtual machines. While
 it is possible to use SeaBIOS to get similar results to an actual PCI 
passthough, the setup process is different and it is generally 
preferable to use the EFI method if your hardware supports it.
</p>
<h3><span class="mw-headline" id="Configuring_libvirt">Configuring libvirt</span></h3>
<p><a href="https://wiki.archlinux.org/index.php/Libvirt" title="Libvirt">Libvirt</a>
 is a wrapper for a number of virtualization utilities that greatly 
simplifies the configuration and deployment process of virtual machines.
 In the case of KVM and QEMU, the frontend it provides allows us to 
avoid dealing with the permissions for QEMU and make it easier to add 
and remove various devices on a live VM. Its status as a wrapper, 
however, means that it might not always support all of the latest qemu 
features, which could end up requiring the use of a wrapper script to 
provide some extra arguments to QEMU.
</p><p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=qemu">qemu</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=libvirt">libvirt</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=ovmf">ovmf</a></span>, and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=virt-manager">virt-manager</a></span>.
</p><p>You can now <a href="https://wiki.archlinux.org/index.php/Enable" class="mw-redirect" title="Enable">enable</a> and <a href="https://wiki.archlinux.org/index.php/Start" class="mw-redirect" title="Start">start</a> <code>libvirtd.service</code> and its logging component <code>virtlogd.socket</code>.
</p><p>You may also need to <a rel="nofollow" class="external text" href="https://wiki.libvirt.org/page/Networking#NAT_forwarding_.28aka_.22virtual_networks.22.29">activate the default libvirt network</a>.
</p>
<h3><span class="mw-headline" id="Setting_up_the_guest_OS">Setting up the guest OS</span></h3>
<p>The process of setting up a VM using <code>virt-manager</code> is mostly self-explanatory, as most of the process comes with fairly comprehensive on-screen instructions.
</p><p>If using <code>virt-manager</code>, you have to add your user to the <code>libvirt</code> <a href="https://wiki.archlinux.org/index.php/User_group" class="mw-redirect" title="User group">user group</a> to ensure authentication.
</p><p>However, you should pay special attention to the following steps:
</p>
<ul><li>When the VM creation wizard asks you to name your VM (final step
 before clicking "Finish"), check the "Customize before install" 
checkbox.</li>
<li>In the "Overview" section, <a rel="nofollow" class="external text" href="https://i.imgur.com/73r2ctM.png">set your firmware to "UEFI"</a>. If the option is grayed out, make sure that:
<ul><li>Your hypervisor is running as a system session and not a user session. This can be verified <a rel="nofollow" class="external text" href="https://i.ibb.co/N1XZCdp/Deepin-Screenshot-select-area-20190125113216.png">by clicking, then hovering</a>
 over the session in virt-manager. If you are accidentally running it as
 a user session, you must open a new connection by clicking "File" &gt; 
"Add Connection..", then select the option from the drop-down menu 
station "QEMU/KVM" and not "QEMU/KVM user session".</li>
<li>It could be a libvirt bug, check out this forum thread for more information: <a rel="nofollow" class="external free" href="https://bbs.archlinux.org/viewtopic.php?pid=1869349">https://bbs.archlinux.org/viewtopic.php?pid=1869349</a></li></ul></li>
<li>In the "CPUs" section, change your CPU model to "host-passthrough". 
If it is not in the list, you will have to type it by hand. This will 
ensure that your CPU is detected properly, since it causes libvirt to 
expose your CPU capabilities exactly as they are instead of only those 
it recognizes (which is the preferred default behavior to make CPU 
behavior easier to reproduce). Without it, some applications may 
complain about your CPU being of an unknown model.</li>
<li>If you want to minimize IO overhead, go into "Add Hardware" and add a
 Controller for SCSI drives of the "VirtIO SCSI" model. You can then 
change the default IDE disk for a SCSI disk, which will bind to said 
controller.
<ul><li>Windows VMs will not recognize those drives by default, so you need to download the ISO containing the drivers from <a rel="nofollow" class="external text" href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/latest-virtio/">here</a>
 and add an IDE (or SATA for Windows 8.1 and newer) CD-ROM storage 
device linking to said ISO, otherwise you will not be able to get 
Windows to recognize it during the installation process. When prompted 
to select a disk to install windows on, load the drivers contained on 
the CD-ROM under <i>vioscsi</i>.</li></ul></li></ul>
<p>The rest of the installation process will take place as normal using a
 standard QXL video adapter running in a window. At this point, there is
 no need to install additional drivers for the rest of the virtual 
devices, since most of them will be removed later on. Once the guest OS 
is done installing, simply turn off the virtual machine. It is possible 
you will be dropped into the UEFI menu instead of starting the 
installation upon powering your VM for the first time. Sometimes the 
correct ISO file was not automatically detected and you will need to 
manually specify the drive to boot. By typing exit and navigating to 
"boot manager" you will enter a menu that allows you to choose between 
devices.
</p>
<h3><span class="mw-headline" id="Attaching_the_PCI_devices">Attaching the PCI devices</span></h3>
<p>With the installation done, it is now possible to edit the hardware 
details in libvirt and remove virtual integration devices, such as the 
spice channel and virtual display, the QXL video adapter, the emulated 
mouse and keyboard and the USB tablet device. Since that leaves you with
 no input devices, you may want to bind a few USB host devices to your 
VM as well, but remember to <b>leave at least one mouse and/or keyboard assigned to your host</b>
 in case something goes wrong with the guest. At this point, it also 
becomes possible to attach the PCI device that was isolated earlier; 
simply click on "Add Hardware" and select the PCI Host Devices you want 
to passthrough. If everything went well, the screen plugged into your 
GPU should show the OVMF splash screen and your VM should start up 
normally. From there, you can setup the drivers for the rest of your VM.
</p>
<h3><span id="Passing_keyboard.2Fmouse_via_Evdev"></span><span class="mw-headline" id="Passing_keyboard/mouse_via_Evdev">Passing keyboard/mouse via Evdev</span></h3>
<p>If you do not have a spare mouse or keyboard to dedicate to your 
guest, and you do not want to suffer from the video overhead of Spice, 
you can setup evdev to swap control of your mouse and keyboard between 
the host and guest on the fly.
</p><p>First, modify the libvirt configuration
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;domain type='kvm'&gt;
</pre>
<p>to
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;domain type='kvm' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'&gt;
</pre>
<p>Next, find your keyboard and mouse devices in <code>/dev/input/by-id/</code>. You may find multiple devices associated to your mouse or keyboard, so try <code>cat /dev/input/by-id/<i>device_id</i></code>
 and either hit some keys on the keyboard or wiggle your mouse to see if
 input comes through, if so you have got the right device. Now add those
 devices to your configuration right before the closing &lt;/domain&gt; 
tag:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
 &lt;qemu:commandline&gt;
 &lt;qemu:arg value='-object'/&gt;
 &lt;qemu:arg value='input-linux,id=mouse1,evdev=/dev/input/by-id/MOUSE_NAME'/&gt;
 &lt;qemu:arg value='-object'/&gt;
 &lt;qemu:arg value='input-linux,id=kbd1,evdev=/dev/input/by-id/KEYBOARD_NAME,grab_all=on,repeat=on'/&gt;
 &lt;/qemu:commandline&gt;
...
</pre>
<p>Replace <code>MOUSE_NAME</code> and <code>KEYBOARD_NAME</code> with 
your device id. You will also need to include these devices in your qemu
 config, and setting the user and group to one that has access to your 
input devices:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">/etc/libvirt/qemu.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
user = "&lt;your_user&gt;"
group = "kvm"
...
cgroup_device_acl = [
    "/dev/kvm",
    "/dev/input/by-id/KEYBOARD_NAME",
    "/dev/input/by-id/MOUSE_NAME",
    "/dev/null", "/dev/full", "/dev/zero",
    "/dev/random", "/dev/urandom",
    "/dev/ptmx", "/dev/kvm", "/dev/kqemu",
    "/dev/rtc","/dev/hpet", "/dev/sev"
]
...
</pre>
<p>Then ensure that the user you provided has access to the <code>kvm</code> and <code>input</code> <a href="https://wiki.archlinux.org/index.php/User_group" class="mw-redirect" title="User group">user groups</a>. <a href="https://wiki.archlinux.org/index.php/Restart" class="mw-redirect" title="Restart">Restart</a> <code>libvirtd.service</code>.
 Now you can startup the guest OS and test swapping control of your 
mouse and keyboard between the host and guest by pressing both the left 
and right control keys at the same time.
</p><p>You may also consider switching from PS/2 to Virtio inputs in your configurations:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
&lt;input type='mouse' bus='virtio'&gt;
        &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x0e' function='0x0'/&gt;
&lt;/input&gt;
&lt;input type='keyboard' bus='virtio'&gt;
        &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x0f' function='0x0'/&gt;
&lt;/input&gt;
&lt;input type='mouse' bus='ps2'/&gt;
&lt;input type='keyboard' bus='ps2'/&gt;
...
</pre>
<p>Next startup the guest OS and install the virtIO drivers for those devices.
</p>
<h3><span class="mw-headline" id="Gotchas_2">Gotchas</span></h3>
<h4><span class="mw-headline" id="Using_a_non-EFI_image_on_an_OVMF-based_VM">Using a non-EFI image on an OVMF-based VM</span></h4>
<p>The OVMF firmware does not support booting off non-EFI mediums. If 
the installation process drops you in a UEFI shell right after booting, 
you may have an invalid EFI boot media. Try using an alternate 
Linux/Windows image to determine if you have an invalid media.
</p>
<h2><span class="mw-headline" id="Performance_tuning">Performance tuning</span></h2>
<p>Most use cases for PCI passthroughs relate to performance-intensive 
domains such as video games and GPU-accelerated tasks. While a PCI 
passthrough on its own is a step towards reaching native performance, 
there are still a few ajustments on the host and guest to get the most 
out of your VM.
</p>
<h3><span class="mw-headline" id="CPU_pinning">CPU pinning</span></h3>
<p>The default behavior for KVM guests is to run operations coming from 
the guest as a number of threads representing virtual processors. Those 
threads are managed by the Linux scheduler like any other thread and are
 dispatched to any available CPU cores based on niceness and priority 
queues. As such, the local CPU cache benefits (L1/L2) are lost each time
 the host scheduler reschedules the virtual CPU thread on a different 
physical CPU. This can noticeably harm performance on the guest. CPU 
pinning aims to resolve this by limiting which physical CPUs the virtual
 CPUs are allowed to run on. The ideal setup is a one to one mapping 
such that the virtual CPU cores match physical CPU cores while taking 
hyperthreading/SMT into account.
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong>
 For certain users enabling CPU pinning may introduce stuttering and 
short hangs, especially with the MuQSS scheduler (present in linux-ck 
and linux-zen kernels). You might want to try disabling pinning first if
 you experience similar issues, which effectively trades maximum 
performance for responsiveness at all times.</div>
<h4><span class="mw-headline" id="CPU_topology">CPU topology</span></h4>
<p>Most modern CPUs support hardware multitasking, also known as 
hyper-threading on Intel CPUs or SMT on AMD CPUs. Hyper-threading/SMT is
 simply a very efficient way of running two threads on one CPU core at 
any given time. You will want to take into consideration that the CPU 
pinning you choose will greatly depend on what you do with your host 
while your VM is running.
</p><p>To find the topology for your CPU run <code>lscpu -e</code>:
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> Pay special attention to the 4th column <b>"CORE"</b> as this shows the association of the Physical/Logical CPU cores</div>
<p><code>lscpu -e</code> on a 6c/12t Ryzen 5 1600:
</p>
<pre>CPU NODE SOCKET CORE L1d:L1i:L2:L3 ONLINE MAXMHZ    MINMHZ
0   0    0      0    0:0:0:0       yes    3800.0000 1550.0000
1   0    0      0    0:0:0:0       yes    3800.0000 1550.0000
2   0    0      1    1:1:1:0       yes    3800.0000 1550.0000
3   0    0      1    1:1:1:0       yes    3800.0000 1550.0000
4   0    0      2    2:2:2:0       yes    3800.0000 1550.0000
5   0    0      2    2:2:2:0       yes    3800.0000 1550.0000
6   0    0      3    3:3:3:1       yes    3800.0000 1550.0000
7   0    0      3    3:3:3:1       yes    3800.0000 1550.0000
8   0    0      4    4:4:4:1       yes    3800.0000 1550.0000
9   0    0      4    4:4:4:1       yes    3800.0000 1550.0000
10  0    0      5    5:5:5:1       yes    3800.0000 1550.0000
11  0    0      5    5:5:5:1       yes    3800.0000 1550.0000
</pre>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong>
 Ryzen 3000 ComboPi AGESA changes topology to match Intel example, even 
on prior generation CPUs. Above valid only on older AGESA. </div>
<p><code>lscpu -e</code> on a 6c/12t Intel 8700k:
</p>
<pre>CPU NODE SOCKET CORE L1d:L1i:L2:L3 ONLINE MAXMHZ    MINMHZ
0   0    0      0    0:0:0:0       yes    4600.0000 800.0000
1   0    0      1    1:1:1:0       yes    4600.0000 800.0000
2   0    0      2    2:2:2:0       yes    4600.0000 800.0000
3   0    0      3    3:3:3:0       yes    4600.0000 800.0000
4   0    0      4    4:4:4:0       yes    4600.0000 800.0000
5   0    0      5    5:5:5:0       yes    4600.0000 800.0000
6   0    0      0    0:0:0:0       yes    4600.0000 800.0000
7   0    0      1    1:1:1:0       yes    4600.0000 800.0000
8   0    0      2    2:2:2:0       yes    4600.0000 800.0000
9   0    0      3    3:3:3:0       yes    4600.0000 800.0000
10  0    0      4    4:4:4:0       yes    4600.0000 800.0000
11  0    0      5    5:5:5:0       yes    4600.0000 800.0000
</pre>
<p>As we see above, with AMD <b>Core 0</b> is sequential with <b>CPU 0 &amp; 1</b>, whereas Intel places <b>Core 0</b> on <b>CPU 0 &amp; 6</b>.
</p><p>If you do not need all cores for the guest, it would then be 
preferable to leave at the very least one core for the host. Choosing 
which cores one to use for the host or guest should be based on the 
specific hardware characteristics of your CPU, however <b>Core 0</b> is a
 good choice for the host in most cases. If any cores are reserved for 
the host, it is recommended to pin the emulator and iothreads, if used, 
to the host cores rather than the VCPUs. This may improve performance 
and reduce latency for the guest since those threads will not pollute 
the cache or contend for scheduling with the guest VCPU threads. If all 
cores are passed to the guest, there is no need or benefit to pinning 
the emulator or iothreads.
</p>
<h4><span class="mw-headline" id="XML_examples">XML examples</span></h4>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> Do not use the <b>iothread</b> lines from the XML examples shown below if you have not added an <b>iothread</b> to your disk controller. <b>iothread'</b>s only work on <b>virtio-scsi</b> or <b>virtio-blk</b> devices.</div>
<h5><span id="4c.2F1t_CPU_w.2Fo_Hyperthreading_Example"></span><span class="mw-headline" id="4c/1t_CPU_w/o_Hyperthreading_Example">4c/1t CPU w/o Hyperthreading Example</span></h5>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
&lt;vcpu placement='static'&gt;4&lt;/vcpu&gt;
&lt;cputune&gt;
    &lt;vcpupin vcpu='0' cpuset='0'/&gt;
    &lt;vcpupin vcpu='1' cpuset='1'/&gt;
    &lt;vcpupin vcpu='2' cpuset='2'/&gt;
    &lt;vcpupin vcpu='3' cpuset='3'/&gt;
&lt;/cputune&gt;
...
</pre>
<h5><span id="4c.2F2t_Intel_CPU_pinning_example"></span><span class="mw-headline" id="4c/2t_Intel_CPU_pinning_example">4c/2t Intel CPU pinning example</span></h5>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
&lt;vcpu placement='static'&gt;8&lt;/vcpu&gt;
&lt;iothreads&gt;1&lt;/iothreads&gt;
&lt;cputune&gt;
    &lt;vcpupin vcpu='0' cpuset='2'/&gt;
    &lt;vcpupin vcpu='1' cpuset='8'/&gt;
    &lt;vcpupin vcpu='2' cpuset='3'/&gt;
    &lt;vcpupin vcpu='3' cpuset='9'/&gt;
    &lt;vcpupin vcpu='4' cpuset='4'/&gt;
    &lt;vcpupin vcpu='5' cpuset='10'/&gt;
    &lt;vcpupin vcpu='6' cpuset='5'/&gt;
    &lt;vcpupin vcpu='7' cpuset='11'/&gt;
    &lt;emulatorpin cpuset='0,6'/&gt;
    &lt;iothreadpin iothread='1' cpuset='0,6'/&gt;
&lt;/cputune&gt;
    ...
    &lt;topology sockets='1' cores='4' threads='2'/&gt;
    ...
</pre>
<h5><span id="4c.2F2t_AMD_CPU_example_.28Before_ComboPi_AGESA.29"></span><span class="mw-headline" id="4c/2t_AMD_CPU_example_(Before_ComboPi_AGESA)">4c/2t AMD CPU example (Before ComboPi AGESA)</span></h5>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
&lt;vcpu placement='static'&gt;8&lt;/vcpu&gt;
&lt;iothreads&gt;1&lt;/iothreads&gt;
&lt;cputune&gt;
  &lt;vcpupin vcpu='0' cpuset='2'/&gt;
  &lt;vcpupin vcpu='1' cpuset='3'/&gt;
  &lt;vcpupin vcpu='2' cpuset='4'/&gt;
  &lt;vcpupin vcpu='3' cpuset='5'/&gt;
  &lt;vcpupin vcpu='4' cpuset='6'/&gt;
  &lt;vcpupin vcpu='5' cpuset='7'/&gt;
  &lt;vcpupin vcpu='6' cpuset='8'/&gt;
  &lt;vcpupin vcpu='7' cpuset='9'/&gt;
  &lt;emulatorpin cpuset='0-1'/&gt;
  &lt;iothreadpin iothread='1' cpuset='0-1'/&gt;
&lt;/cputune&gt;
    ...
    &lt;topology sockets='1' cores='4' threads='2'/&gt;
    ...
</pre>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> If further CPU isolation is needed, consider using the <b>isolcpus</b> kernel command-line parameter on the unused physical/logical cores.</div>
<p>If you do not intend to be doing any computation-heavy work on the 
host (or even anything at all) at the same time as you would on the VM, 
you may want to pin your VM threads across all of your cores, so that 
the VM can fully take advantage of the spare CPU time the host has 
available. Be aware that pinning all physical and logical cores of your 
CPU could induce latency in the guest VM.
</p>
<h3><span class="mw-headline" id="Huge_memory_pages">Huge memory pages</span></h3>
<p>When dealing with applications that require large amounts of memory, 
memory latency can become a problem since the more memory pages are 
being used, the more likely it is that this application will attempt to 
access information across multiple memory "pages", which is the base 
unit for memory allocation. Resolving the actual address of the memory 
page takes multiple steps, and so CPUs normally cache information on 
recently used memory pages to make subsequent uses on the same pages 
faster. Applications using large amounts of memory run into a problem 
where, for instance, a virtual machine uses 4 GiB of memory divided into
 4 KiB pages (which is the default size for normal pages) for a total of
 1.04 million pages, meaning that such cache misses can become extremely
 frequent and greatly increase memory latency. Huge pages exist to 
mitigate this issue by giving larger individual pages to those 
applications, increasing the odds that multiple operations will target 
the same page in succession.
</p>
<h4><span class="mw-headline" id="Transparent_huge_pages">Transparent huge pages</span></h4>
<p>QEMU will use 2MiB sized transparent huge pages automatically without
 any explicit configuration in QEMU or Libvirt, subject to some 
important caveats. When using VFIO the pages are locked in at boot time 
and transparent huge pages are allocated up front when the VM first 
boots. If the kernel memory is highly fragmented, or the VM is using a 
majority of the remaining free memory, it is likely that the kernel will
 not have enough 2MiB pages to fully satisfy the allocation. In such a 
case, it silently fails by using a mix of 2MiB and 4KiB pages. Since the
 pages are locked in VFIO mode, the kernel will not be able to convert 
those 4KiB pages to huge after the VM starts either. The number of 
available 2MiB huge pages available to THP is the same as via the <a href="#Dynamic_huge_pages">#Dynamic huge pages</a> mechanism described in the following sections.
</p><p>To check how much memory THP is using globally:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ grep AnonHugePages /proc/meminfo</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">AnonHugePages:   8091648 kB
</pre>
<p>To check a specific QEMU instance. QEMU's PID must be substituted in the grep command:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ grep -P 'AnonHugePages:\s+(?!0)\d+' /proc/[PID]/smaps</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">AnonHugePages:   8087552 kB
</pre>
<p>In this example, the VM was allocated 8388608KiB of memory, but only 
8087552KiB was available via THP. The remaining 301056KiB are allocated 
as 4KiB pages. Aside from manually checking, there is no indication when
 partial allocations occur.  As such, THP's effectiveness is very much 
dependent on the host system's memory fragmentation at the time of VM 
startup. If this trade off is unacceptable or strict guarantees are 
required, <a href="#Static_huge_pages">#Static huge pages</a> is recommended.
</p><p>Arch kernels have THP compiled in and enabled by default with <code>/sys/kernel/mm/transparent_hugepage/enabled</code> set to <code>madvise</code> mode.
</p>
<h4><span class="mw-headline" id="Static_huge_pages">Static huge pages</span></h4>
<p>While transparent huge pages should work in the vast majority of 
cases, they can also be allocated statically during boot. This should 
only be needed to make use 1 GiB hugepages on machines that support it, 
since transparent huge pages normally only go up to 2 MiB.
</p>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong>
 Static huge pages lock down the allocated amount of memory, making it 
unavailable for applications that are not configured to use them. 
Allocating 4 GiBs worth of huge pages on a machine with 8 GiB of memory 
will only leave you with 4 GiB of available memory on the host <b>even when the VM is not running</b>.</div>
<p>To allocate huge pages at boot, one must simply specify the desired amount on their kernel command line with <code>hugepages=<i>x</i></code>. For instance, reserving 1024 pages with <code>hugepages=1024</code> and the default size of 2048 KiB per huge page creates 2 GiB worth of memory for the virtual machine to use.
</p><p>If supported by CPU page size could be set manually. 1 GiB huge page support could be verified by <code>grep pdpe1gb /proc/cpuinfo</code>. Setting 1 GiB huge page size via kernel parameters&nbsp;: <code>default_hugepagesz=1G hugepagesz=1G hugepages=X</code>.
</p><p>Also, since static huge pages can only be used by applications 
that specifically request it, you must add this section in your libvirt 
domain configuration to allow kvm to benefit from them&nbsp;:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
&lt;memoryBacking&gt;
	&lt;hugepages/&gt;
&lt;/memoryBacking&gt;
...
</pre>
<h4><span class="mw-headline" id="Dynamic_huge_pages">Dynamic huge pages</span></h4>
<div class="noprint archwiki-template-message">
<p><a href="https://wiki.archlinux.org/index.php/File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="PCI%20passthrough%20via%20OVMF%20-%20ArchWiki_files/Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="https://wiki.archlinux.org/index.php/File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="PCI%20passthrough%20via%20OVMF%20-%20ArchWiki_files/Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div><b>Reason:</b> Need futher testing if this variant as effective as static one (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:PCI_passthrough_via_OVMF">Talk:PCI passthrough via OVMF#</a>)</div>
</div>
<p>Hugepages could be allocated manually via <code>vm.nr_overcommit_hugepages</code> <a href="https://wiki.archlinux.org/index.php/Sysctl" title="Sysctl">sysctl</a> parameter.
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">/etc/sysctl.d/10-kvm.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">vm.nr_hugepages = 0
vm.nr_overcommit_hugepages = <i>num</i></pre>
<p>Where <code><i>num</i></code> - is the number of huge pages, which default size if 2 MiB.
Pages will be automatically allocated, and freed after VM stops.
</p><p>More manual way:
</p>
<pre># echo <i>num</i> &gt; /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages
# echo <i>num</i> &gt; /sys/kernel/mm/hugepages/hugepages-1048576kB/nr_hugepages
</pre>
<p>For 2 MiB and 1 GiB page size respectively.
And they should be manually freed in the same way.
</p><p>It is hardly recommended to drop caches, compact memory and wait 
couple of seconds before starting VM, as there could be not enough free 
contiguous memory for required huge pages blocks. Especially after some 
uptime of the host system.
</p>
<pre># echo 3 &gt; /proc/sys/vm/drop_caches
# echo 1 &gt; /proc/sys/vm/compact_memory
</pre>
<p>Theoretically, 1 GiB pages works as 2 MiB. But practically - no 
guaranteed way was found to get contiguous 1 GiB memory blocks. Each 
consequent request of 1 GiB blocks lead to lesser and lesser dynamically
 allocated count.
</p>
<h3><span class="mw-headline" id="CPU_frequency_governor">CPU frequency governor</span></h3>
<p>Depending on the way your <a href="https://wiki.archlinux.org/index.php/CPU_frequency_scaling" title="CPU frequency scaling">CPU governor</a>
 is configured, the VM threads may not hit the CPU load thresholds for 
the frequency to ramp up. Indeed, KVM cannot actually change the CPU 
frequency on its own, which can be a problem if it does not scale up 
with vCPU usage as it would result in underwhelming performance. An easy
 way to see if it behaves correctly is to check if the frequency 
reported by <code>watch lscpu</code> goes up when running a 
CPU-intensive task on the guest. If you are indeed experiencing stutter 
and the frequency does not go up to reach its reported maximum, it may 
be due to <a rel="nofollow" class="external text" href="https://lime-technology.com/forum/index.php?topic=46664.msg447678#msg447678">cpu scaling being controlled by the host OS</a>.
 In this case, try setting all cores to maximum frequency to see if this
 improves performance. Note that if you are using a modern intel chip 
with the default pstate driver, cpupower commands will be <a href="https://wiki.archlinux.org/index.php/CPU_frequency_scaling#CPU_frequency_driver" title="CPU frequency scaling">ineffective</a>, so monitor <code>/proc/cpuinfo</code> to make sure your cpu is actually at max frequency.
</p>
<h3><span class="mw-headline" id="Isolating_pinned_CPUs">Isolating pinned CPUs</span></h3>
<p>CPU pinning by itself won't prevent other host processes from running
 on the pinned CPUs. Properly isolating the pinned CPUs can reduce 
latency in the guest VM.
</p>
<h4><span class="mw-headline" id="With_isolcpus_kernel_parameter">With isolcpus kernel parameter</span></h4>
<p>In this example, let us assume you are using CPUs 4-7.
Use the <a href="https://wiki.archlinux.org/index.php/Kernel_parameters" title="Kernel parameters">kernel parameters</a> <code>isolcpus nohz_full rcu_nocbs</code> to completely isolate the CPUs from the kernel. For example:
</p>
<pre>isolcpus=4-7 nohz_full=4-7 rcu_nocbs=4-7
</pre>
<p>Then, run <code>qemu-system-x86_64</code> with taskset and chrt:
</p>
<pre># chrt -r 1 taskset -c 4-7 qemu-system-x86_64 ...
</pre>
<p>The <code>chrt</code> command will ensure that the task scheduler 
will round-robin distribute work (otherwise it will all stay on the 
first cpu). For <code>taskset</code>, the CPU numbers can be comma- and/or dash-separated, like "0,1,2,3" or "0-4" or "1,7-8,10" etc.
</p><p>See <a rel="nofollow" class="external text" href="https://www.removeddit.com/r/VFIO/comments/6vgtpx/high_dpc_latency_and_audio_stuttering_on_windows/dm0sfto/">this Removeddit mirror of a Reddit thread</a> for more info. (<a rel="nofollow" class="external text" href="https://www.reddit.com/r/VFIO/comments/6vgtpx/high_dpc_latency_and_audio_stuttering_on_windows/dm0sfto/">The original thread</a> is worthless because of deleted comments.)
</p>
<h4><span class="mw-headline" id="Dynamically_isolating_CPUs">Dynamically isolating CPUs</span></h4>
<p>The isolcpus kernel parameter will permanently reserve CPU cores, 
even when the guest isn't running. A more flexible alternative is to use
 the cset tool from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/cpuset-git/">cpuset-git</a></span><sup><small>AUR</small></sup> to dynamically isolate CPUs when starting the guest.
</p><p>See this <a rel="nofollow" class="external text" href="https://www.redhat.com/archives/vfio-users/2016-September/msg00072.html">vfio-users post</a> for more info, as well as this <a rel="nofollow" class="external text" href="https://rokups.github.io/#!pages/gaming-vm-performance.md">blog post</a> and this <a rel="nofollow" class="external text" href="https://github.com/PassthroughPOST/VFIO-Tools/blob/master/libvirt_hooks/hooks/cset.sh">script</a> for working examples.
</p>
<h3><span class="mw-headline" id="Improving_performance_on_AMD_CPUs">Improving performance on AMD CPUs</span></h3>
<p>Previously, Nested Page Tables (NPT) had to be disabled on AMD systems running KVM to improve GPU performance because of a <a rel="nofollow" class="external text" href="https://sourceforge.net/p/kvm/bugs/230/">very old bug</a>, but the trade off was decreased CPU performance, including stuttering.
</p><p>There is a <a rel="nofollow" class="external text" href="https://patchwork.kernel.org/patch/10027525/">kernel patch</a> that resolves this issue, which was accepted into kernel 4.14-stable and 4.9-stable.  If you are running the official <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=linux">linux</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=linux-lts">linux-lts</a></span>
 kernel the patch has already been applied (make sure you are on the 
latest). If you are running another kernel you might need to manually 
patch yourself.
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> Several Ryzen users (see <a rel="nofollow" class="external text" href="https://www.reddit.com/r/VFIO/comments/78i3jx/possible_fix_for_the_npt_issue_discussed_on_iommu/">this Reddit thread</a>) have tested the patch, and can confirm that it works, bringing GPU passthrough performance up to near native quality.</div>
<p>Starting with QEMU 3.1 the TOPOEXT cpuid flag is disabled by default.
 In order to use hyperthreading(SMT) on AMD CPUs you need to manually 
enable it:
</p>
<pre> &lt;cpu mode='host-passthrough' check='none'&gt;
 &lt;topology sockets='1' cores='4' threads='2'/&gt;
 &lt;feature policy='require' name='topoext'/&gt;
 &lt;/cpu&gt;
</pre>
<p>commit: <a rel="nofollow" class="external free" href="https://git.qemu.org/?p=qemu.git;a=commit;h=7210a02c58572b2686a3a8d610c6628f87864aed">https://git.qemu.org/?p=qemu.git;a=commit;h=7210a02c58572b2686a3a8d610c6628f87864aed</a>
</p>
<h3><span class="mw-headline" id="Further_tuning">Further tuning</span></h3>
<p>More specialized VM tuning tips are available at <a rel="nofollow" class="external text" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html-single/Virtualization_Tuning_and_Optimization_Guide/index.html">Red Hat's Virtualization Tuning and Optimization Guide</a>. This guide may be especially helpful if you are experiencing:
</p>
<ul><li>Moderate CPU load on the host during downloads/uploads from within the guest: See <i>Bridge Zero Copy Transmit</i> for a potential fix.</li>
<li>Guests capping out at certain network speeds during downloads/uploads despite virtio-net being used: See <i>Multi-queue virtio-net</i> for a potential fix.</li>
<li>Guests "stuttering" under high I/O, despite the same workload not affecting hosts to the same degree: See <i>Multi-queue virtio-scsi</i> for a potential fix.</li></ul>
<h2><span class="mw-headline" id="Special_procedures">Special procedures</span></h2>
<p>Certain setups require specific configuration tweaks in order to work
 properly. If you are having problems getting your host or your VM to 
work properly, see if your system matches one of the cases below and try
 adjusting your configuration accordingly.
</p>
<h3><span class="mw-headline" id="Using_identical_guest_and_host_GPUs">Using identical guest and host GPUs</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="https://wiki.archlinux.org/index.php/File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="PCI%20passthrough%20via%20OVMF%20-%20ArchWiki_files/Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="https://wiki.archlinux.org/index.php/File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="PCI%20passthrough%20via%20OVMF%20-%20ArchWiki_files/Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div><b>Reason:</b> A number of users have been having issues with this, it should probably be adressed by the article. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:PCI_passthrough_via_OVMF#Additionnal_sections">Talk:PCI passthrough via OVMF#Additionnal sections</a>)</div>
</div>
<p>Due to how vfio-pci uses your vendor and device id pair to identify 
which device they need to bind to at boot, if you have two GPUs sharing 
such an ID pair you will not be able to get your passthough driver to 
bind with just one of them. This sort of setup makes it necessary to use
 a script, so that whichever driver you are using is instead assigned by
 pci bus address using the <code>driver_override</code> mechanism.
</p>
<h4><span class="mw-headline" id="Script_variants">Script variants</span></h4>
<h5><span class="mw-headline" id="Passthrough_all_GPUs_but_the_boot_GPU">Passthrough all GPUs but the boot GPU</span></h5>
<p>Here, we will make a script to bind vfio-pci to all GPUs but the boot gpu. Create the script <code>/usr/local/bin/vfio-pci-override.sh</code>:
</p>
<pre>#!/bin/sh

for i in /sys/bus/pci/devices/*/boot_vga; do
    if [ $(cat "$i") -eq 0 ]; then
        GPU="${i%/boot_vga}"
        AUDIO="$(echo "$GPU" | sed -e "s/0$/1/")"
        echo "vfio-pci" &gt; "$GPU/driver_override"
        if [ -d "$AUDIO" ]; then
            echo "vfio-pci" &gt; "$AUDIO/driver_override"
        fi
    fi
done

modprobe -i vfio-pci
</pre>
<h5><span class="mw-headline" id="Passthrough_selected_GPU">Passthrough selected GPU</span></h5>
<p>In this case we manually specify the GPU to bind.
</p>
<pre>#!/bin/sh

DEVS="0000:03:00.0 0000:03:00.1"

if [ ! -z "$(ls -A /sys/class/iommu)" ]; then
    for DEV in $DEVS; do
        echo "vfio-pci" &gt; /sys/bus/pci/devices/$DEV/driver_override
    done
fi
</pre>
<h4><span class="mw-headline" id="Script_installation">Script installation</span></h4>
<p>Edit <code>/etc/mkinitcpio.conf</code>:
</p>
<ol><li>Add <code>modconf</code> to the <a href="https://wiki.archlinux.org/index.php/Mkinitcpio#HOOKS" title="Mkinitcpio">HOOKS</a> array and <code>/usr/local/bin/vfio-pci-override.sh</code> to the <a href="https://wiki.archlinux.org/index.php/Mkinitcpio#BINARIES_and_FILES" title="Mkinitcpio">FILES</a> array.</li></ol>
<p>Edit <code>/etc/modprobe.d/vfio.conf</code>:
</p>
<ol><li>Add the following line: <code>install vfio-pci /usr/local/bin/vfio-pci-override.sh</code></li>
<li><a href="https://wiki.archlinux.org/index.php/Regenerate_the_initramfs" class="mw-redirect" title="Regenerate the initramfs">Regenerate the initramfs</a> and reboot.</li></ol>
<h3><span class="mw-headline" id="Passing_the_boot_GPU_to_the_guest">Passing the boot GPU to the guest</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="https://wiki.archlinux.org/index.php/File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="PCI%20passthrough%20via%20OVMF%20-%20ArchWiki_files/Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="https://wiki.archlinux.org/index.php/File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="PCI%20passthrough%20via%20OVMF%20-%20ArchWiki_files/Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div><b>Reason:</b> This is related to VBIOS issues and should be moved into a separate section regarding VBIOS compatibility. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:PCI_passthrough_via_OVMF#UEFI_(OVMF)_Compatibility_in_VBIOS">Talk:PCI passthrough via OVMF#UEFI (OVMF) Compatibility in VBIOS</a>)</div>
</div>
<p>The GPU marked as <code>boot_vga</code> is a special case when it 
comes to doing PCI passthroughs, since the BIOS needs to use it in order
 to display things like boot messages or the BIOS configuration menu. To
 do that, it makes <a rel="nofollow" class="external text" href="https://www.redhat.com/archives/vfio-users/2016-May/msg00224.html">a copy of the VGA boot ROM which can then be freely modified</a>.
 This modified copy is the version the system gets to see, which the 
passthrough driver may reject as invalid. As such, it is generally 
recommended to change the boot GPU in the BIOS configuration so the host
 GPU is used instead or, if that is not possible, to swap the host and 
guest cards in the machine itself.
</p>
<h3><span class="mw-headline" id="Using_Looking_Glass_to_stream_guest_screen_to_the_host">Using Looking Glass to stream guest screen to the host</span></h3>
<p>It is possible to make VM share the monitor, and optionally a keyboard and a mouse with a help of <a rel="nofollow" class="external text" href="https://looking-glass.hostfission.com/">Looking Glass</a>.
</p>
<h4><span class="mw-headline" id="Adding_IVSHMEM_Device_to_VM">Adding IVSHMEM Device to VM</span></h4>
<p>Looking glass works by creating a shared memory buffer between a host
 and a guest. This is a lot faster than streaming frames via localhost, 
but requires additional setup. 
</p><p>With your VM turned off open the machine configuration
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
&lt;devices&gt;
    ...
  &lt;shmem name='looking-glass'&gt;
    &lt;model type='ivshmem-plain'/&gt;
    &lt;size unit='M'&gt;32&lt;/size&gt;
  &lt;/shmem&gt;
&lt;/devices&gt;
...
</pre>
<p>You should replace 32 with your own calculated value based on what 
resolution you are going to pass through. It can be calculated like 
this:
</p>
<pre>width x height x 4 x 2 = total bytes
total bytes / 1024 / 1024 = total mebibytes + 2
</pre>
<p>For example, in case of 1920x1080
</p>
<pre>1920 x 1080 x 4 x 2 = 16,588,800 bytes
16,588,800 / 1024 / 1024 = 15.82 MiB + 2 = 17.82
</pre>
<p>The result must be <b>rounded up</b> to the nearest power of two, and since 17.82 is bigger than 16 we should choose 32.
</p><p>Next create a configuration file to create the shared memory file on boot
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">/etc/tmpfiles.d/10-looking-glass.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">f	/dev/shm/looking-glass	0660	<b>user</b>	kvm	-</pre>
<p>Replace user with your username.
</p><p>Ask systemd-tmpfiles to create the shared memory file now without waiting to next boot
</p>
<pre># systemd-tmpfiles --create /etc/tmpfiles.d/10-looking-glass.conf
</pre>
<h4><span class="mw-headline" id="Installing_the_IVSHMEM_Host_to_Windows_guest">Installing the IVSHMEM Host to Windows guest</span></h4>
<p>Currently Windows would not notify users about a new IVSHMEM device, 
it would silently install a dummy driver. To actually enable the device 
you have to go into device manager and update the driver for the device 
under the "System Devices" node for <b>"PCI standard RAM Controller"</b>. Download the signed driver <a rel="nofollow" class="external text" href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/upstream-virtio/">from Red Hat</a>.
</p><p>Once the driver is installed you must download a matching <a rel="nofollow" class="external text" href="https://github.com/gnif/LookingGlass/releases">looking-glass-host</a>
 that matches the client you installed from AUR and start it on your 
guest. In order to run it you would also need to install Microsoft 
Visual C++ Redistributable from <a rel="nofollow" class="external text" href="https://www.visualstudio.com/downloads/">Microsoft</a>
It is also possible to make it start automatically on VM boot by editing the <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</code> registry and adding a path to the downloaded executable.
</p>
<h4><span class="mw-headline" id="Getting_a_client">Getting a client</span></h4>
<p>Looking glass client can be installed from AUR using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/looking-glass/">looking-glass</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/looking-glass-git/">looking-glass-git</a></span><sup><small>AUR</small></sup> packages.
</p><p>You can start it once the VM is set up and running
</p>
<pre>$ looking-glass-client
</pre>
<p>If you do not want to use Spice to control the guest mouse and keyboard you can disable the Spice server.
</p>
<pre>$ looking-glass-client -s
</pre>
<p>Additionally you may want to start Looking Glass Client as full 
screen, otherwise the image may be scaled down resulting in poor image 
fidelity.
</p>
<pre>$ looking-glass-client -F
</pre>
<p>Launch with the <code>--help</code> option for further information.
</p>
<h3><span class="mw-headline" id="Swap_peripherals_to_and_from_the_Host">Swap peripherals to and from the Host</span></h3>
<p>Looking Glass includes a Spice client in order to control mouse 
movement on the Windows guest. However this may have too much latency 
for certain applications, such as gaming. An alternative method is 
passing through specific USB devices for minimal latency. This allows 
for switching the devices between host and guest.
</p><p>First create a .xml file for the device(s) you wish to pass-through, which libvirt will use to identify the device.
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">~/.VFIOinput/input_1.xml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;hostdev mode='subsystem' type='usb' managed='no'&gt;
&lt;source&gt;
&lt;vendor id='0x[Before Colon]'/&gt;
&lt;product id='0x[After Colon]'/&gt;
&lt;/source&gt;
&lt;/hostdev&gt;</pre>
<p>Replace [Before/After Colon] with the contents of the 'lsusb' command, specific to the device you want to pass-through.
</p><p>For instance my mouse is <code>Bus 005 Device 002: ID 1532:0037 Razer USA, Ltd</code> so I would replace <code>vendor id</code> with 1532, and <code>product id</code> with 1037.
</p><p>Repeat this process for any additional USB devices you want to pass-through. If your mouse / keyboard has multiple entries in <code>lsusb</code>, perhaps if it is wireless, then create additional xml files for each.
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> Do not forget to change the path &amp; name of the script(s) above and below to match your user and specific system.</div>
<p>Next a bash script file is needed to tell libvirt what to attach/detach the USB devices to the guest.
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">~/.VFIOinput/input_attach.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash

virsh attach-device [VM-Name] [USBdevice]</pre>
<p>Replace [VM-Name] with the name of your virtual machine, which can be
 seen under virt-manager. Additionally replace [USBdevice] with the <b>full</b>
 path to the .xml file for the device you wish to pass-through. Add 
additional lines for more than 1 device. For example here is my script:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">~/.VFIOinput/input_attach.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash

virsh attach-device win10 /home/$USER/.VFIOinput/input_mouse.xml
virsh attach-device win10 /home/$USER/.VFIOinput/input_keyboard.xml</pre>
<p>Next duplicate the script file and replace <code>attach-device</code> with <code>detach-device</code>. Ensure both scripts are executable with <code>chmod +x $script.sh</code>
</p><p>This 2 script files can now be executed to attach or detach your 
USB devices from the host to the guest VM. It is important to note that 
they may need to be executed as root. To run the script from the Windows
 VM, one possibility is using <a href="https://wiki.archlinux.org/index.php/PuTTY" title="PuTTY">PuTTY</a> to <a href="https://wiki.archlinux.org/index.php/SSH" class="mw-redirect" title="SSH">SSH</a>
 into the host, and execute the script. On Windows PuTTY comes with 
plink.exe which can execute singular commands over SSH before then 
logging out, instead of opening a SSH terminal, all in the background.
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">detach_devices.bat</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">"C:\Program Files\PuTTY\plink.exe" root@$HOST_IP -pw $ROOTPASSWORD /home/$USER/.VFIOinput/input_detach.sh</pre>
<p>Replace <code>$HOST_IP</code> with the Host <a href="https://wiki.archlinux.org/index.php/Network_configuration#IP_addresses" title="Network configuration">IP Address</a> and $ROOTPASSWORD with the root password.
</p>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong>
 This method is insecure if somebody has access to your VM, since they 
could open the file and read your password. It is advisable to use <a href="https://wiki.archlinux.org/index.php/SSH_keys" title="SSH keys">SSH keys</a> instead!</div>
<p>You may also want to execute the script files using key binds. On Windows one option is <a rel="nofollow" class="external text" href="https://autohotkey.com/">Autohotkey</a>, and on the Host <a href="https://wiki.archlinux.org/index.php/Xbindkeys" title="Xbindkeys">Xbindkeys</a>. Because of the need to run the scripts as root, you may also need to use <a href="https://wiki.archlinux.org/index.php/Polkit" title="Polkit">Polkit</a> or <a href="https://wiki.archlinux.org/index.php/Sudo" title="Sudo">Sudo</a> which can both be used to authenticate specific executables as able to run as root without needing a password.
</p>
<h3><span id="Bypassing_the_IOMMU_groups_.28ACS_override_patch.29"></span><span class="mw-headline" id="Bypassing_the_IOMMU_groups_(ACS_override_patch)">Bypassing the IOMMU groups (ACS override patch)</span></h3>
<p>If you find your PCI devices grouped among others that you do not 
wish to pass through, you may be able to seperate them using Alex 
Williamson's ACS override patch. Make sure you understand <a rel="nofollow" class="external text" href="https://vfio.blogspot.com/2014/08/iommu-groups-inside-and-out.html">the potential risk</a> of doing so. 
</p><p>You will need a kernel with the patch applied. The easiest method to acquiring this is through the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/linux-vfio/">linux-vfio</a></span><sup><small>AUR</small></sup> package. 
</p><p>In addition, the ACS override patch needs to be enabled with 
kernel command line options.  The patch file adds the following 
documentation:
</p>
<pre>pcie_acs_override =
        [PCIE] Override missing PCIe ACS support for:
    downstream
        All downstream ports - full ACS capabilties
    multifunction
        All multifunction devices - multifunction ACS subset
    id:nnnn:nnnn
        Specfic device - full ACS capabilities
        Specified as vid:did (vendor/device ID) in hex
</pre>
<p>The option <code>pcie_acs_override=downstream,multifunction</code> should break up as many devices as possible.
</p><p>After installation and configuration, reconfigure your <a href="https://wiki.archlinux.org/index.php/Kernel_parameters" title="Kernel parameters">bootloader kernel parameters</a> to load the new kernel with the <code>pcie_acs_override=</code> option enabled.
</p>
<h2><span class="mw-headline" id="Plain_QEMU_without_libvirt">Plain QEMU without libvirt</span></h2>
<p>Instead of setting up a virtual machine with the help of libvirt, 
plain QEMU commands with custom parameters can be used for running the 
VM intended to be used with PCI passthrough. This is desirable for some 
use cases like scripted setups, where the flexibility for usage with 
other scripts is needed.
</p><p>To achieve this after <a href="#Setting_up_IOMMU">#Setting up IOMMU</a> and <a href="#Isolating_the_GPU">#Isolating the GPU</a>, follow the <a href="https://wiki.archlinux.org/index.php/QEMU" title="QEMU">QEMU</a> article to setup the virtualized environment, <a href="https://wiki.archlinux.org/index.php/QEMU#Enabling_KVM" title="QEMU">enable KVM</a> on it and use the flag <code>-device vfio-pci,host=07:00.0</code> replacing the identifier (07:00.0) with your actual device's ID that you used for the GPU isolation earlier.
</p><p>For utilizing the OVMF firmware, make sure the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=ovmf">ovmf</a></span> package is installed, copy the UEFI variables from <code>/usr/share/ovmf/x64/OVMF_VARS.fd</code> to temporary location like <code>/tmp/MY_VARS.fd</code> and finally specify the OVMF paths by appending the following parameters to the QEMU command (order matters):
</p>
<ul><li><code>-drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/OVMF_CODE.fd</code> for the actual OVMF firmware binary, note the readonly option</li>
<li><code>-drive if=pflash,format=raw,file=/tmp/MY_VARS.fd</code> for the variables</li></ul>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> QEMU's default SeaBIOS can be used instead of OVMF, but it is not recommended as it can cause issues with passthrough setups.</div>
<p>It is recommended to study the QEMU article for ways to enhance the performance by using the <a href="https://wiki.archlinux.org/index.php/QEMU#Installing_virtio_drivers" title="QEMU">virtio drivers</a> and other further configurations for the setup.
</p><p>You also might have to use the <code>-cpu host,kvm=off</code> 
parameter to forward the host's CPU model info to the VM and fool the 
virtualization detection used by Nvidia's and possibly other 
manufacturers' device drivers trying to block the full hardware usage 
inside a virtualized system.
</p>
<h2><span class="mw-headline" id="Passing_though_other_devices">Passing though other devices</span></h2>
<h3><span class="mw-headline" id="USB_controller">USB controller</span></h3>
<p>If your motherboard has multiple USB controllers mapped to multiple 
groups, it is possible to pass those instead of USB devices. Passing an 
actual controller over an individual USB device provides the following 
advantages&nbsp;: 
</p>
<ul><li>If a device disconnects or changes ID over the course of an 
given operation (such as a phone undergoing an update), the VM will not 
suddenly stop seeing it.</li>
<li>Any USB port managed by this controller is directly handled by the 
VM and can have its devices unplugged, replugged and changed without 
having to notify the hypervisor.</li>
<li>Libvirt will not complain if one of the USB devices you usually pass to the guest is missing when starting the VM.</li></ul>
<p>Unlike with GPUs, drivers for most USB controllers do not require any
 specific configuration to work on a VM and control can normally be 
passed back and forth between the host and guest systems with no side 
effects.
</p>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong> Make sure your USB controller supports resetting: <a href="#Passing_through_a_device_that_does_not_support_resetting">#Passing through a device that does not support resetting</a></div>
<p>You can find out which PCI devices correspond to which controller and
 how various ports and devices are assigned to each one of them using 
this command&nbsp;:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ for usb_ctrl in $(find /sys/bus/usb/devices/usb* -maxdepth 0 -type l); do pci_path="$(dirname "$(realpath "${usb_ctrl}")")"; echo "Bus $(cat "${usb_ctrl}/busnum") --&gt; $(basename $pci_path) (IOMMU group $(basename $(realpath $pci_path/iommu_group)))"; lsusb -s "$(cat "${usb_ctrl}/busnum"):"; echo; done</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Bus 1 --&gt; 0000:00:1a.0 (IOMMU group 4)
Bus 001 Device 004: ID 04f2:b217 Chicony Electronics Co., Ltd Lenovo Integrated Camera (0.3MP)
Bus 001 Device 007: ID 0a5c:21e6 Broadcom Corp. BCM20702 Bluetooth 4.0 [ThinkPad]
Bus 001 Device 008: ID 0781:5530 SanDisk Corp. Cruzer
Bus 001 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub

Bus 2 --&gt; 0000:00:1d.0 (IOMMU group 9)
Bus 002 Device 006: ID 0451:e012 Texas Instruments, Inc. TI-Nspire Calculator
Bus 002 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</pre>
<p>This laptop has 3 USB ports managed by 2 USB controllers, each with 
their own IOMMU group. In this example, Bus 001 manages a single USB 
port (with a SanDisk USB pendrive plugged into it so it appears on the 
list), but also a number of internal devices, such as the internal 
webcam and the bluetooth card. Bus 002, on the other hand, does not 
apprear to manage anything except for the calculator that is plugged 
into it. The third port is empty, which is why it does not show up on 
the list, but is actually managed by Bus 002.
</p><p>Once you have identified which controller manages which ports by 
plugging various devices into them and decided which one you want to 
passthrough, simply add it to the list of PCI host devices controlled by
 the VM in your guest configuration. No other configuration should be 
needed.
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong>
 If your USB controller does not support resetting, is not in an 
isolated group, or is otherwise unable to be passed through then it may 
still be possible to accomplish similar results through <a href="https://wiki.archlinux.org/index.php/Udev" title="Udev">udev</a> rules. See <a rel="nofollow" class="external autonumber" href="https://github.com/olavmrk/usb-libvirt-hotplug">[1]</a> which allows any device connected to specified USB ports to be automatically attached to a virtual machine.</div>
<h3><span class="mw-headline" id="Passing_VM_audio_to_host_via_PulseAudio">Passing VM audio to host via PulseAudio</span></h3>
<p>It is possible to route the virtual machine's audio to the host as an
 application using libvirt. This has the advantage of multiple audio 
streams being routable to one host output, and working with audio output
 devices that do not support passthrough. <a href="https://wiki.archlinux.org/index.php/PulseAudio" title="PulseAudio">PulseAudio</a> is required for this to work.
</p><p>First, remove the comment from the <code>#user = ""</code> line. Then add your username in the quotations. This tells QEMU which user's pulseaudio stream to route through.
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">/etc/libvirt/qemu.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">user = "example"</pre>
<p>Next, modify the libvirt configuration
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;domain type='kvm'&gt;
</pre>
<p>to
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;domain type='kvm' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'&gt;
</pre>
<p>Then set the QEMU PulseAudio environment variables at the bottom of the libvirt xml file
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">    &lt;/devices&gt;
   &lt;/domain&gt;
</pre>
<p>to
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">    &lt;/devices&gt;
      &lt;qemu:commandline&gt;
        &lt;qemu:env name='QEMU_AUDIO_DRV' value='pa'/&gt;
        &lt;qemu:env name='QEMU_PA_SERVER' value='/run/user/1000/pulse/native'/&gt;
      &lt;/qemu:commandline&gt;
 &lt;/domain&gt;
</pre>
<p>Change 1000 under the user directory to your user uid (which can be found by running the <code>id</code>
 command. Remember to save the file and exit it without ending the 
process before continuing, otherwise the changes will not register. If 
you get the message <code>Domain [vmname] XML configuration edited.</code> after exiting, it means that your changes have been applied.
</p><p><a href="https://wiki.archlinux.org/index.php/Restart" class="mw-redirect" title="Restart">Restart</a> <code>libvirtd.service</code> and <a href="https://wiki.archlinux.org/index.php/Systemd/User" title="Systemd/User">user service</a> <code>pulseaudio.service</code>.
</p><p>Virtual Machine audio will now be routed through the host as an application. The application <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=pavucontrol">pavucontrol</a></span> can be used to control the output device. Be aware that on Windows guests, this can cause audio crackling without <a href="#Slowed_down_audio_pumped_through_HDMI_on_the_video_card">using Message-Signaled Interrupts.</a>
</p>
<h4><span class="mw-headline" id="QEMU_3.0_audio_changes">QEMU 3.0 audio changes</span></h4>
<p>As of QEMU 3.0 part of the audio patches have been merged (<a rel="nofollow" class="external text" href="https://www.reddit.com/r/VFIO/comments/97iuov/qemu_30_released/e49wmyd/">reddit link</a>). The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/qemu-patched/">qemu-patched</a></span><sup><small>AUR</small></sup><sup>[<a href="https://wiki.archlinux.org/index.php/Help:Procedures#Fix_broken_package_links" title="Help:Procedures">broken link</a>: package not found]</sup> package currently includes some additional audio patches, as some of the patches have not been officially up-streamed yet.
</p><p>You will need to change the chipset accordingly to how your VM is set up, i.e. <code>pc-q35-3.0</code> or <code>pc-i440fx-3.0</code> (after installing qemu 3.0) to use the new code paths:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;domain type='kvm'&gt;
  ...
  &lt;os&gt;
    &lt;type arch='x86_64' machine='pc-q35-3.0'&gt;hvm&lt;/type&gt;
    ...
  &lt;/os&gt;
</pre>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;domain type='kvm'&gt;
  ...
  &lt;os&gt;
    &lt;type arch='x86_64' machine='pc-i440fx-3.0'&gt;hvm&lt;/type&gt;
    ...
  &lt;/os&gt;
</pre>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> 
<ul><li>To speed up compilation time with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/qemu-patched/">qemu-patched</a></span><sup><small>AUR</small></sup><sup>[<a href="https://wiki.archlinux.org/index.php/Help:Procedures#Fix_broken_package_links" title="Help:Procedures">broken link</a>: package not found]</sup> use <code>--target-list=x86_64-softmmu</code> to compile qemu with only x86_64 guest support.</li>
<li>Since Qemu 3.0 the XML arguments <code>qemu:env</code> above are <i>not</i> needed if you run PulseAudio as your user and you have <code>nographics_allow_host_audio = 1</code> enabled in <code>/etc/libvirt/qemu.conf</code>. If you use a different user with QEMU/Libvirt, you will need to keep the <code>QEMU_PA_SERVER</code> variable otherwise permission errors will occur.</li></ul>
</div>
<h3><span class="mw-headline" id="Passing_VM_audio_to_host_via_Scream_and_IVSHMEM">Passing VM audio to host via Scream and IVSHMEM</span></h3>
<p>It is possible to pass VM audio through a IVSHMEM device to the host using <a rel="nofollow" class="external text" href="https://github.com/duncanthrax/scream">scream</a>. 
This guide will only cover using PulseAudio as a receiver on the host.
See the project page for more details.
</p>
<h4><span class="mw-headline" id="Adding_the_IVSHMEM">Adding the IVSHMEM</span></h4>
<p>With the VM turned off, edit the machine configuration
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
&lt;devices&gt;
    ...
  &lt;shmem name='scream-ivshmem'&gt;
    &lt;model type='ivshmem-plain'/&gt;
    &lt;size unit='M'&gt;2&lt;/size&gt;
  &lt;/shmem&gt;
&lt;/devices&gt;
...
</pre>
<p>In the above configuration, the size of the IVSHMEM device is 2MB (the recommended amount). Change this as needed.
</p><p>Now refer to <a href="#Adding_IVSHMEM_Device_to_VM">#Adding IVSHMEM Device to VM</a> to configure the host to create the shared memory file on boot, replacing <code>looking-glass</code> with <code>scream-ivshmem</code>.
</p>
<h4><span class="mw-headline" id="Configuring_the_Windows_guest">Configuring the Windows guest</span></h4>
<p>The correct driver must be installed for the IVSHMEM device on the guest. 
See <a href="#Installing_the_IVSHMEM_Host_to_Windows_guest">#Installing the IVSHMEM Host to Windows guest</a>. Ignore the part about <code>looking-glass-host</code>.
</p><p>Install the <a rel="nofollow" class="external text" href="https://github.com/duncanthrax/scream/releases">scream</a> virtual audio driver on the guest. 
If you have secure boot enabled for your VM, you may need to disable it. 
</p><p>Using the registry editor, set the DWORD <code>HKLM\SYSTEM\CurrentControlSet\Services\Scream\Options\UseIVSHMEM</code> to the size of the IVSHMEM device in MB.
Note that scream identifies its IVSHMEM device using its size, so make sure there is only one device of that size.
</p>
<h4><span class="mw-headline" id="Configuring_the_host">Configuring the host</span></h4>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/scream-pulse/">scream-pulse</a></span><sup><small>AUR</small></sup>.
</p><p>Create the systemd user service file to control the reciever
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">~/.config/systemd/user/scream-ivshmem-pulse.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Scream IVSHMEM pulse reciever
After=pulseaudio.service
Wants=pulseaudio.service

[Service]
Type=simple
ExecStartPre=/usr/bin/truncate -s 0 /dev/shm/scream-ivshmem
ExecStartPre=/usr/bin/dd if=/dev/zero of=/dev/shm/scream-ivshmem bs=1M count=2
ExecStart=/usr/bin/scream-ivshmem-pulse /dev/shm/scream-ivshmem

[Install]
WantedBy=default.target

</pre>
<p>Edit <code>count=2</code> with the size of the IVSHMEM device in MB.
</p><p>Now start the service with 
</p>
<pre>$ systemctl start --user scream-ivshmem-pulse
</pre>
<p>To have it automatically start on next login, enable the service
</p>
<pre>$ systemctl enable --user scream-ivshmem-pulse
</pre>
<h3><span id="Physical_disk.2Fpartition"></span><span class="mw-headline" id="Physical_disk/partition">Physical disk/partition</span></h3>
<p>A whole disk or a partition may be used as a whole for improved I/O performance by adding an entry to the XML
</p><p>Virtio-BLK Example:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> 
&lt;devices&gt;
...
  &lt;disk type='block' device='disk'&gt;
    &lt;driver name='qemu' type='raw' cache='none' io='native'/&gt;
    &lt;source dev='/dev/disk/by-id/xxxxxxxx'/&gt;
    &lt;target dev='vda' bus='virtio'/&gt;
  &lt;/disk&gt;
...
&lt;/devices&gt;

</pre>
<p>Virtio-SCSI Example:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> 
&lt;devices&gt;
...
  &lt;disk type='block' device='disk'&gt;
    &lt;driver name='qemu' type='raw' cache='none' io='native'/&gt;
    &lt;source dev='/dev/disk/by-id/xxxxxxxx'/&gt;
    &lt;target dev='sda' bus='scsi'/&gt;
  &lt;/disk&gt;
...
&lt;/devices&gt;

</pre>
<p>To find out which disk/partition is associated with the one you would like to pass:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ ls -l /dev/disk/by-id</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ata-ST1000LM002-9VQ14L_Z0501SZ9 -&gt; ../../sdd
ata-ST1000LM002-9VQ14L_Z0501SZ9-part1 -&gt; ../../sdd1
</pre>
<p>You can also add the disk with Virt-Manager's <b>Add Hardware</b> menu and then type the disk you want in the <b>Select or create custom storage</b> box, e.g. <b>/dev/disk/by-id/ata-ST1000LM002-9VQ14L_Z0501SZ9</b>
</p><p>Depending on which bus you use, the above step will require 
either the VIOSTOR(bus=virtio) or VIOSCSI(bus=scsi) driver on Windows 
guests, refer to <a href="#Setting_up_the_guest_OS">#Setting up the guest OS</a> for the driver ISO.
</p>
<h3><span class="mw-headline" id="Gotchas_3">Gotchas</span></h3>
<h4><span class="mw-headline" id="Passing_through_a_device_that_does_not_support_resetting">Passing through a device that does not support resetting</span></h4>
<p>When the VM shuts down, all devices used by the guest are 
deinitialized by its OS in preparation for shutdown. In this state, 
those devices are no longer functional and must then be power-cycled 
before they can resume normal operation. Linux can handle this 
power-cycling on its own, but when a device has no known reset methods, 
it remains in this disabled state and becomes unavailable. Since Libvirt
 and Qemu both expect all host PCI devices to be ready to reattach to 
the host before completely stopping the VM, when encountering a device 
that will not reset, they will hang in a "Shutting down" state where 
they will not be able to be restarted until the host system has been 
rebooted. It is therefore reccomanded to only pass through PCI devices 
which the kernel is able to reset, as evidenced by the presence of a <code>reset</code> file in the PCI device sysfs node, such as <code>/sys/bus/pci/devices/0000:00:1a.0/reset</code>.
</p><p>The following bash command shows which devices can and cannot be reset.
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">for iommu_group in $(find /sys/kernel/iommu_groups/ -maxdepth 1 -mindepth 1 -type d);do echo "IOMMU group $(basename "$iommu_group")"; for device in $(\ls -1 "$iommu_group"/devices/); do if [[ -e "$iommu_group"/devices/"$device"/reset ]]; then echo -n "[RESET]"; fi; echo -n $'\t';lspci -nns "$device"; done; done</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">IOMMU group 0
	00:00.0 Host bridge [0600]: Intel Corporation Xeon E3-1200 v2/Ivy Bridge DRAM Controller [8086:0158] (rev 09)
IOMMU group 1
	00:01.0 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor PCI Express Root Port [8086:0151] (rev 09)
	01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK208 [GeForce GT 720] [10de:1288] (rev a1)
	01:00.1 Audio device [0403]: NVIDIA Corporation GK208 HDMI/DP Audio Controller [10de:0e0f] (rev a1)
IOMMU group 2
	00:14.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB xHCI Host Controller [8086:1e31] (rev 04)
IOMMU group 4
[RESET]	00:1a.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #2 [8086:1e2d] (rev 04)
IOMMU group 5
[RESET]	00:1b.0 Audio device [0403]: Intel Corporation 7 Series/C210 Series Chipset Family High Definition Audio Controller [8086:1e20] (rev 04)
IOMMU group 10
[RESET]	00:1d.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #1 [8086:1e26] (rev 04)
IOMMU group 13
	06:00.0 VGA compatible controller [0300]: NVIDIA Corporation GM204 [GeForce GTX 970] [10de:13c2] (rev a1)
	06:00.1 Audio device [0403]: NVIDIA Corporation GM204 High Definition Audio Controller [10de:0fbb] (rev a1)
</pre>
<p>This signals that the xHCI USB controller in 00:14.0 cannot be reset 
and will therefore stop the VM from shutting down properly, while the 
integrated sound card in 00:1b.0 and the other two controllers in 
00:1a.0 and 00:1d.0 do not share this problem and can be passed without 
issue.
</p>
<h2><span class="mw-headline" id="Complete_setups_and_examples">Complete setups and examples</span></h2>
<p>For many reasons users may seek to see <a href="https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF/Examples" title="PCI passthrough via OVMF/Examples">complete passthrough setup examples</a>.
</p><p>These examples offer a supplement to existing hardware 
compatibility lists. Additionally, if you have trouble configuring a 
certain mechanism in your setup, you might find these examples very 
valuable. Users there have described their setups in detail, and some 
have provided examples of their configuration files as well. 
</p><p>We encourage those who successfully build their system from this 
resource to help improve it by contributing their builds. Due to the 
many different hardware manufacturers involved, the seemingly 
significant lack of sufficient documentation, as well as other issues 
due to the nature of this process, community contributions are 
necessary.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<p>If your issue is not mentioned below, you may want to browse <a href="https://wiki.archlinux.org/index.php/QEMU#Troubleshooting" title="QEMU">QEMU#Troubleshooting</a>.
</p>
<h3><span id="QEMU_4.0:_Unable_to_load_graphics_drivers.2FBSOD.2FGraphics_stutter_after_driver_install_using_Q35"></span><span class="mw-headline" id="QEMU_4.0:_Unable_to_load_graphics_drivers/BSOD/Graphics_stutter_after_driver_install_using_Q35">QEMU 4.0: Unable to load graphics drivers/BSOD/Graphics stutter after driver install using Q35</span></h3>
<p>Starting with QEMU 4.0, the Q35 machine type changes the default <code>kernel_irqchip</code> from <code>off</code> to <code>split</code>
 which breaks some guest devices, such as nVidia graphics (the driver 
fails to load / black screen / code 43 / graphics stutters, usually when
 mouse moving). Switch to full KVM mode instead by adding <code>&lt;ioapic driver='kvm'/&gt;</code> under libvirt's <code>&lt;features&gt;</code> tag in your VM configuration or by adding <code>kernel_irqchip=on</code> in the <code>-machine</code> QEMU arg.
</p>
<h3><span id=".22Error_43:_Driver_failed_to_load.22_on_Nvidia_GPUs_passed_to_Windows_VMs"></span><span class="mw-headline" id="&quot;Error_43:_Driver_failed_to_load&quot;_on_Nvidia_GPUs_passed_to_Windows_VMs">"Error 43: Driver failed to load" on Nvidia GPUs passed to Windows VMs</span></h3>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> 
<ul><li>This may also fix SYSTEM_THREAD_EXCEPTION_NOT_HANDLED boot crashes related to Nvidia drivers.</li>
<li>This may also fix problems under linux guests.</li></ul>
</div>
<p>Since version 337.88, Nvidia drivers on Windows check if an 
hypervisor is running and fail if it detects one, which results in an 
Error 43 in the Windows device manager. Starting with QEMU 2.5.0 and 
libvirt 1.3.3, the vendor_id for the hypervisor can be spoofed, which is
 enough to fool the Nvidia drivers into loading anyway. All one must do 
is add <code>hv_vendor_id=whatever</code> to the hypervisor parameters 
in their QEMU command line, or by adding the following line to their 
libvirt domain configuration. The vendor_id can be <a rel="nofollow" class="external text" href="https://libvirt.org/formatdomain.html#elementsFeatures">any string value up to 12 characters</a>.
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
&lt;features&gt;
	&lt;hyperv&gt;
		...
		&lt;vendor_id state='on' value='whatever'/&gt;
		...
	&lt;/hyperv&gt;
	...
	&lt;kvm&gt;
	&lt;hidden state='on'/&gt;
	&lt;/kvm&gt;
&lt;/features&gt;
...
</pre>
<p>Users with older versions of QEMU and/or libvirt will instead have to
 disable a few hypervisor extensions, which can degrade performance 
substantially. If this is what you want to do, do the following 
replacement in your libvirt domain config file.
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ virsh edit [vmname]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
&lt;features&gt;
	&lt;hyperv&gt;
		&lt;relaxed state='on'/&gt;
		&lt;vapic state='on'/&gt;
		&lt;spinlocks state='on' retries='8191'/&gt;
	&lt;/hyperv&gt;
	...
&lt;/features&gt;
...
&lt;clock offset='localtime'&gt;
	&lt;timer name='hypervclock' present='yes'/&gt;
&lt;/clock&gt;
...
</pre>
<pre>...
&lt;clock offset='localtime'&gt;
	&lt;timer name='hypervclock' present='no'/&gt;
&lt;/clock&gt;
...
&lt;features&gt;
	&lt;kvm&gt;
	&lt;hidden state='on'/&gt;
	&lt;/kvm&gt;
	...
	&lt;hyperv&gt;
		&lt;relaxed state='off'/&gt;
		&lt;vapic state='off'/&gt;
		&lt;spinlocks state='off'/&gt;
	&lt;/hyperv&gt;
	...
&lt;/features&gt;
...
</pre>
<h3><span id=".22BAR_3:_cannot_reserve_.5Bmem.5D.22_error_in_dmesg_after_starting_VM"></span><span class="mw-headline" id="&quot;BAR_3:_cannot_reserve_[mem]&quot;_error_in_dmesg_after_starting_VM">"BAR 3: cannot reserve [mem]" error in dmesg after starting VM</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="https://wiki.archlinux.org/index.php/File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="PCI%20passthrough%20via%20OVMF%20-%20ArchWiki_files/Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="https://wiki.archlinux.org/index.php/File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="PCI%20passthrough%20via%20OVMF%20-%20ArchWiki_files/Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div><b>Reason:</b> This error is actually related to the boot_vgs issue
 and should be merged together with everything else concerning GPU ROMs.
 (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:PCI_passthrough_via_OVMF#UEFI_(OVMF)_Compatibility_in_VBIOS">Talk:PCI passthrough via OVMF#UEFI (OVMF) Compatibility in VBIOS</a>)</div>
</div>
<p>With respect to <a rel="nofollow" class="external text" href="https://www.linuxquestions.org/questions/linux-kernel-70/kernel-fails-to-assign-memory-to-pcie-device-4175487043/">this article</a>:
</p><p>If you still have code 43 check dmesg for memory reservation 
errors after starting up VM, if you have similar it could be the case:
</p>
<pre>vfio-pci 0000:09:00.0: BAR 3: cannot reserve [mem 0xf0000000-0xf1ffffff 64bit pref]
</pre>
<p>Find out a PCI Bridge your graphic card is connected to. This will give actual hierarchy of devices:
</p>
<pre>$ lspci -t
</pre>
<p>Before starting VM run following lines replacing IDs with actual from previous output.
</p>
<pre># echo 1 &gt; /sys/bus/pci/devices/0000\:00\:03.1/remove
# echo 1 &gt; /sys/bus/pci/rescan
</pre>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> Probably setting <a href="https://wiki.archlinux.org/index.php/Kernel_parameter" class="mw-redirect" title="Kernel parameter">kernel parameter</a> <code>video=efifb:off</code> is required as well. <a rel="nofollow" class="external text" href="https://pve.proxmox.com/wiki/Pci_passthrough#BAR_3:_can.27t_reserve_.5Bmem.5D_error">Source</a></div>
<p>In addition try adding kernel parameter <code>pci=realloc</code> which also <a rel="nofollow" class="external text" href="https://github.com/Dunedan/mbp-2016-linux/issues/60#issuecomment-396311301">helps with hotplugging issues</a>.
</p>
<h3><span id="UEFI_.28OVMF.29_compatibility_in_VBIOS"></span><span class="mw-headline" id="UEFI_(OVMF)_compatibility_in_VBIOS">UEFI (OVMF) compatibility in VBIOS</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="https://wiki.archlinux.org/index.php/File:Tango-edit-cut.png" class="image"><img alt="Tango-edit-cut.png" src="PCI%20passthrough%20via%20OVMF%20-%20ArchWiki_files/Tango-edit-cut.png" decoding="async" width="48" height="48"></a><b>This section is being considered for removal.</b><a href="https://wiki.archlinux.org/index.php/File:Tango-edit-cut.png" class="image"><img alt="Tango-edit-cut.png" src="PCI%20passthrough%20via%20OVMF%20-%20ArchWiki_files/Tango-edit-cut.png" decoding="async" width="48" height="48"></a></p>
<div><b>Reason:</b> Flashing you guest GPU for the purpose of a GPU passthrough is <b>never</b> good advice. A full section should be dedicated to VBIOS compatibility. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:PCI_passthrough_via_OVMF#UEFI_(OVMF)_Compatibility_in_VBIOS">Talk:PCI passthrough via OVMF#UEFI (OVMF) Compatibility in VBIOS</a>)</div>
</div>
<p>With respect to <a rel="nofollow" class="external text" href="https://pve.proxmox.com/wiki/Pci_passthrough#How_to_known_if_card_is_UEFI_.28ovmf.29_compatible">this article</a>:
</p><p>Error 43 can be caused by the GPU's VBIOS without UEFI support. To check whenever your VBIOS supports it, you will have to use <code>rom-parser</code>:
</p>
<pre>$ git clone <a rel="nofollow" class="external free" href="https://github.com/awilliam/rom-parser">https://github.com/awilliam/rom-parser</a>
$ cd rom-parser &amp;&amp; make
</pre>
<p>Dump the GPU VBIOS:
</p>
<pre># echo 1 &gt; /sys/bus/pci/devices/0000:01:00.0/rom
# cat /sys/bus/pci/devices/0000:01:00.0/rom &gt; /tmp/image.rom
# echo 0 &gt; /sys/bus/pci/devices/0000:01:00.0/rom
</pre>
<p>And test it for compatibility:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ ./rom-parser /tmp/image.rom</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Valid ROM signature found @600h, PCIR offset 190h
	PCIR: type 0 (x86 PC-AT), vendor: 10de, device: 1184, class: 030000
	PCIR: revision 0, vendor revision: 1
Valid ROM signature found @fa00h, PCIR offset 1ch
	PCIR: type 3 (EFI), vendor: 10de, device: 1184, class: 030000
	PCIR: revision 3, vendor revision: 0
		EFI: Signature Valid, Subsystem: Boot, Machine: X64
	Last image
</pre>
<p>To be UEFI compatible, you need a "type 3 (EFI)" in the result. If it
 is not there, try updating your GPU VBIOS. GPU manufacturers often 
share VBIOS upgrades on their support pages. A large database of known 
compatible and working VBIOSes (along with their UEFI compatibility 
status!) is available on <a rel="nofollow" class="external text" href="https://www.techpowerup.com/vgabios/">TechPowerUp</a>.
</p><p>Updated VBIOS can be used in the VM without flashing. To load it in QEMU:
</p>
<pre>-device vfio-pci,host=07:00.0,......,romfile=/path/to/your/gpu/bios.bin \
</pre>
<p>And in libvirt:
</p>
<pre>&lt;hostdev&gt;
     ...
     &lt;rom file='/path/to/your/gpu/bios.bin'/&gt;
     ...
   &lt;/hostdev&gt;</pre>
<p>One should compare VBIOS versions between host and guest systems using <a rel="nofollow" class="external text" href="https://www.techpowerup.com/download/nvidia-nvflash/">nvflash</a> (Linux versions under <i>Show more versions</i>) or 
<a rel="nofollow" class="external text" href="https://www.techpowerup.com/download/techpowerup-gpu-z/">GPU-Z</a> (in Windows guest). To check the currently loaded VBIOS:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ ./nvflash --version</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Version               : 80.04.XX.00.97
...
UEFI Support          : No
UEFI Version          : N/A
UEFI Variant Id       : N/A ( Unknown )
UEFI Signer(s)        : Unsigned
...
</pre>
<p>And to check a given VBIOS file:
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">$ ./nvflash --version NV299MH.rom</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Version               : 80.04.XX.00.95
...
UEFI Support          : Yes
UEFI Version          : 0x10022 (Jul  2 2013 @ 16377903 )
UEFI Variant Id       : 0x0000000000000004 ( GK1xx )
UEFI Signer(s)        : Microsoft Corporation UEFI CA 2011
...
</pre>
<p>If the external ROM did not work as it should in the guest, you will 
have to flash the newer VBIOS image to the GPU. In some cases it is 
possible to create your own VBIOS image with UEFI support using <a rel="nofollow" class="external text" href="https://www.win-raid.com/t892f16-AMD-and-Nvidia-GOP-update-No-requests-DIY.html">GOPUpd</a> tool, however this is risky and may result in GPU brick.
</p>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong>
 Failure during flashing may "brick" your GPU - recovery may be 
possible, but rarely easy and often requires additional hardware. <b>DO NOT</b>
 flash VBIOS images for other GPU models (different boards may use 
different VBIOSes, clocks, fan configuration). If it breaks, you get to 
keep all the pieces.</div>
<p>In order to avoid the irreparable damage to your graphics adapter it is necessary to unload the NVIDIA kernel driver first:
</p>
<pre># modprobe -r nvidia_modeset nvidia 
</pre>
<p>Flashing the VBIOS can be done with:
</p>
<pre># ./nvflash romfile.bin
</pre>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong> <b>DO NOT</b>
 interrupt the flashing process, even if it looks like it is stuck. 
Flashing should take about a minute on most GPUs, but may take longer.</div>
<h3><span class="mw-headline" id="Slowed_down_audio_pumped_through_HDMI_on_the_video_card">Slowed down audio pumped through HDMI on the video card</span></h3>
<p>For some users VM's audio slows down/starts stuttering/becomes 
demonic after a while when it is pumped through HDMI on the video card. 
This usually also slows down graphics.
A possible solution consists of enabling MSI (Message Signaled-Based 
Interrupts) instead of the default (Line-Based Interrupts).
</p><p>In order to check whether MSI is supported or enabled, run the following command as root:
</p>
<pre># lspci -vs $device | grep 'MSI:'
</pre>
<p>where `$device` is the card's address (e.g. `01:00.0`).
</p><p>The output should be similar to:
</p>
<pre>Capabilities: [60] MSI: Enable<b>-</b> Count=1/1 Maskable- 64bit+
</pre>
<p>A <code>-</code> after <code>Enable</code> means MSI is supported, but not used by the VM, while a <code>+</code> says that the VM is using it.
</p><p>The procedure to enable it is quite complex, instructions and an overview of the setting can be found <a rel="nofollow" class="external text" href="https://forums.guru3d.com/showthread.php?t=378044">here</a>.
</p><p>On a linux guest you can use modinfo to see if there is option to
 enable MSI (for example: "modinfo snd_hda_intel |grep msi"). If there 
is, one can enable it by adding the relevant option to a custom omdprobe
 file - in "/etc/modprobe.d/snd-hda-intel.conf" inserting "options 
snd-hda-intel enable_msi=1"
</p><p>Other hints can be found on the <a rel="nofollow" class="external text" href="https://lime-technology.com/wiki/index.php/UnRAID_6/VM_Guest_Support#Enable_MSI_for_Interrupts_to_Fix_HDMI_Audio_Support">lime-technology's wiki</a>, or on this article on <a rel="nofollow" class="external text" href="https://vfio.blogspot.it/2014/09/vfio-interrupts-and-how-to-coax-windows.html">VFIO tips and tricks</a>.
</p><p>A UI tool called <a rel="nofollow" class="external text" href="https://github.com/CHEF-KOCH/MSI-utility">MSI Utility (FOSS Version 2)</a> works with Windows 10 64-bit and simplifies the process.
</p><p>In order to fix the issues enabling MSI on the 0 function of a nVidia card (<code>01:00.0 VGA compatible controller: NVIDIA Corporation GM206 [GeForce GTX 960] (rev a1) (prog-if 00 [VGA controller])</code>) was not enough; it will also be required to enable it on the other function (<code>01:00.1 Audio device: NVIDIA Corporation Device 0fba (rev a1)</code>) to fix the issue.
</p>
<h3><span class="mw-headline" id="No_HDMI_audio_output_on_host_when_intel_iommu_is_enabled">No HDMI audio output on host when intel_iommu is enabled</span></h3>
<p>If after enabling <code>intel_iommu</code> the HDMI output device of Intel GPU becomes unusable on the host then setting the option <code>igfx_off</code> (i.e. <code>intel_iommu=on,igfx_off</code>) might bring the audio back, please read <code>Graphics Problems?</code> in <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/Documentation/Intel-IOMMU.txt">Intel-IOMMU.txt</a> for details about setting <code>igfx_off</code>.
</p>
<h3><span class="mw-headline" id="X_does_not_start_after_enabling_vfio_pci">X does not start after enabling vfio_pci</span></h3>
<p>This is related to the host GPU being detected as a secondary GPU, 
which causes X to fail/crash when it tries to load a driver for the 
guest GPU. To circumvent this, a Xorg configuration file specifying the 
BusID for the host GPU is required. The correct BusID can be acquired 
from lspci or the Xorg log. <a rel="nofollow" class="external text" href="https://www.redhat.com/archives/vfio-users/2016-August/msg00025.html">Source </a>
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">/etc/X11/xorg.conf.d/10-intel.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Section "Device"
        Identifier "Intel GPU"
        Driver "modesetting"
        BusID  "PCI:0:2:0"
EndSection
</pre>
<h3><span class="mw-headline" id="Chromium_ignores_integrated_graphics_for_acceleration">Chromium ignores integrated graphics for acceleration</span></h3>
<p>Chromium and friends will try to detect as many GPUs as they can in 
the system and pick which one is preferred (usually discrete NVIDIA/AMD 
graphics). It tries to pick a GPU by looking at PCI devices, not OpenGL 
renderers available in the system - the result is that Chromium may 
ignore the integrated GPU available for rendering and try to use the 
dedicated GPU bound to the <code>vfio-pci</code> driver, and unusable on
 the host system, regardless of whenever a guest VM is running or not. 
This results in software rendering being used (leading to higher CPU 
load, which may also result in choppy video playback, scrolling and 
general un-smoothness).
</p><p>This can be fixed by <a href="https://wiki.archlinux.org/index.php/Chromium/Tips_and_tricks#Forcing_specific_GPU" title="Chromium/Tips and tricks">explicitly telling Chromium which GPU you want to use</a>.
</p>
<h3><span class="mw-headline" id="VM_only_uses_one_core">VM only uses one core</span></h3>
<p>For some users, even if IOMMU is enabled and the core count is set to
 more than 1, the VM still only uses one CPU core and thread. To solve 
this enable "Manually set CPU topology" in <code>virt-manager</code> and
 set it to the desirable amount of CPU sockets, cores and threads. Keep 
in mind that "Threads" refers to the thread count per CPU, not the total
 count.
</p>
<h3><span class="mw-headline" id="Passthrough_seems_to_work_but_no_output_is_displayed">Passthrough seems to work but no output is displayed</span></h3>
<p>Make sure if you are using virt-manager that UEFI firmware is 
selected for your virtual machine. Also, make sure you have passed the 
correct device to the VM.
</p>
<h3><span class="mw-headline" id="virt-manager_has_permission_issues">virt-manager has permission issues</span></h3>
<p>If you are getting a permission error with virt-manager add the following to your <code>/etc/libvirt/qemu.conf</code>:
</p>
<pre>group="kvm"
user="<i>user</i>"
</pre>
<p>If that does not work make sure your user is added to the <code>kvm</code> and <code>libvirt</code> <a href="https://wiki.archlinux.org/index.php/User_group" class="mw-redirect" title="User group">user groups</a>.
</p>
<h3><span class="mw-headline" id="Host_lockup_after_VM_shutdown">Host lockup after VM shutdown</span></h3>
<p>This issue seems to primarily affect users running a Windows 10 guest
 and usually after the VM has been run for a prolonged period of time: 
the host will experience multiple CPU core lockups (see <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=206050&amp;p=2">[2]</a>).
 To fix this try enabling Message Signal Interrupts on the GPU passed 
through to the guest. A good guide for how to do this can be found in <a rel="nofollow" class="external autonumber" href="https://forums.guru3d.com/threads/windows-line-based-vs-message-signaled-based-interrupts.378044/">[3]</a>. You can also download this application for windows here <a rel="nofollow" class="external autonumber" href="https://github.com/TechtonicSoftware/MSIInturruptEnabler">[4]</a> that should make the process easier.
</p>
<h3><span class="mw-headline" id="Host_lockup_if_guest_is_left_running_during_sleep">Host lockup if guest is left running during sleep</span></h3>
<p>VFIO-enabled virtual machines tend to become unstable if left running
 through a sleep/wakeup cycle and have been known to cause the host 
machine to lockup when an attempt is then made to shut them down. In 
order to avoid this, one can simply prevent the host from going into 
sleep while the guest is running using the following libvirt hook script
 and systemd unit. The hook file needs executable permissions to work.
</p>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">/etc/libvirt/hooks/qemu</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash

OBJECT="$1"
OPERATION="$2"
SUBOPERATION="$3"
EXTRA_ARG="$4"

case "$OPERATION" in
        "prepare")
                systemctl start libvirt-nosleep@"$OBJECT"
                ;;
        "release")
                systemctl stop libvirt-nosleep@"$OBJECT"
                ;;
esac
</pre>
<pre style="margin-bottom: 0px; border-bottom: medium none; padding-bottom: 0.8em; --darkreader-inline-border-bottom:currentcolor;" data-darkreader-inline-border-bottom="">/etc/systemd/system/libvirt-nosleep@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Preventing sleep while libvirt domain "%i" is running

[Service]
Type=simple
ExecStart=/usr/bin/systemd-inhibit --what=sleep --why="Libvirt domain \"%i\" is running" --who=%U --mode=block sleep infinity
</pre>
<h3><span class="mw-headline" id="Cannot_boot_after_upgrading_ovmf">Cannot boot after upgrading ovmf</span></h3>
<p>If you cannot boot after upgrading from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=ovmf">ovmf</a></span> version 1:r23112.018432f0ce-1 then you need to remove the old <code>*VARS.fd</code> file in <code>/var/lib/libvirt/qemu/nvram/</code>:
</p>
<pre># mv /var/lib/libvirt/qemu/nvram/vmname_VARS.fd /var/lib/libvirt/qemu/nvram/vmname_VARS.fd.old
</pre>
<p>See <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/57825">FS#57825</a> for further details.
</p>
<h3><span id="QEMU_via_cli_pulseaudio_stuttering.2Fdelay"></span><span class="mw-headline" id="QEMU_via_cli_pulseaudio_stuttering/delay">QEMU via cli pulseaudio stuttering/delay</span></h3>
<p>Using following flags for the audio device and chipset might help if 
you are running into the stuttering/delay audio issues when running QEMU
 via cli:
</p>
<pre>qemu-system-x86_64 \
-machine pc-i440fx-3.0 \
-device hda-micro \
-soundhw hda \
-...
</pre>
<p>As noted in <a href="#QEMU_3.0_audio_changes">QEMU 3.0 audio changes</a> the specified chipset will include a series of audio patches.
</p><p>Setting <code>QEMU_AUDIO_TIMER_PERIOD</code> to values higher than 100 might also help (did not test value lower than 100).
</p>
<h3><span class="mw-headline" id="Bluescreen_at_boot_since_Windows_10_1803">Bluescreen at boot since Windows 10 1803</span></h3>
<p>Since Windows 10 1803 there is a problem when you are using 
"host-passthrough" as cpu model. The machine cannot boot and is either 
boot looping or you get a bluescreen.
You can workaround this by:
</p>
<pre># echo 1 &gt; /sys/module/kvm/parameters/ignore_msrs
</pre>
<p>To make it permanently you can create a modprobe file <code>kvm.conf</code>:
</p>
<pre>options kvm ignore_msrs=1
</pre>
<h3><span id="AMD_Ryzen_.2F_BIOS_updates_.28AGESA.29_yields_.22Error:_internal_error:_Unknown_PCI_header_type_.E2.80.98127.E2.80.99.22"></span><span class="mw-headline" id="AMD_Ryzen_/_BIOS_updates_(AGESA)_yields_&quot;Error:_internal_error:_Unknown_PCI_header_type_127&quot;">AMD Ryzen / BIOS updates (AGESA) yields "Error: internal error: Unknown PCI header type 127"</span></h3>
<p>AMD users have been experiencing breakage of their KVM setups after updating the BIOS on their motherboard. There is a kernel <a rel="nofollow" class="external text" href="https://clbin.com/VCiYJ">patch</a>, (see <a href="https://wiki.archlinux.org/index.php/Kernel/Arch_Build_System" title="Kernel/Arch Build System">Kernel/Arch Build System</a>
 for instruction on compiling kernels with custom patches) that can 
resolve the issue as of now (7/28/19), but this is not the first time 
AMD has made an error of this very nature, so take this into account if 
you are considering updating your BIOS in the future as a VFIO user.
</p>
<h3><span class="mw-headline" id="Host_crashes_when_hotplugging_Nvidia_card_with_USB">Host crashes when hotplugging Nvidia card with USB</span></h3>
<p>If attempting to hotplug an Nvidia card with a USB port, you may have to blacklist the <code>i2c_nvidia_gpu</code> driver. Do this by adding the line <code>blacklist i2c_nvidia_gpu</code> to <code>/etc/modprobe.d/blacklist.conf</code>.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul><li><a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=162768">Discussion on Arch Linux forums</a> | <a rel="nofollow" class="external text" href="https://archive.is/kZYMt">Archived link</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE">User contributed hardware compatibility list</a></li>
<li><a rel="nofollow" class="external text" href="https://pastebin.com/rcnUZCv7">Example script</a> from <a rel="nofollow" class="external free" href="https://www.youtube.com/watch?v=37D2bRsthfI">https://www.youtube.com/watch?v=37D2bRsthfI</a></li>
<li><a rel="nofollow" class="external text" href="https://vfio.blogspot.com/">Complete tutorial for PCI passthrough</a></li>
<li><a rel="nofollow" class="external text" href="https://www.redhat.com/archives/vfio-users/">VFIO users mailing list</a></li>
<li><a rel="nofollow" class="external text" href="ircs://chat.freenode.net/vfio-users">#vfio-users on freenode</a></li>
<li><a rel="nofollow" class="external text" href="https://www.youtube.com/watch?v=aLeWg11ZBn0">YouTube: Level1Linux - GPU Passthrough for Virtualization with Ryzen</a></li>
<li><a rel="nofollow" class="external text" href="https://www.reddit.com/r/VFIO">/r/VFIO: A subreddit focused on vfio</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/intel/gvt-linux/wiki/GVTd_Setup_Guide">GVT-d: passthrough of an entire integrated GPU</a></li></ul>
<!-- 
NewPP limit report
Cached time: 20200212124733
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.190 seconds
Real time usage: 0.196 seconds
Preprocessor visited node count: 2606/1000000
Preprocessor generated node count: 6813/1000000
Postexpand include size: 36350/2097152 bytes
Template argument size: 19687/2097152 bytes
Highest expansion depth: 5/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip postexpand size: 6685/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   68.031      1 -total
 18.24%   12.406    125 Template:Ic
 15.30%   10.411     47 Template:Hc
  6.07%    4.128     16 Template:Note
  4.46%    3.032      1 Template:Accuracy
  4.38%    2.983      3 Template:Expansion
  4.24%    2.884      5 Template:META_Message
  4.08%    2.775     10 Template:Pkg
  3.87%    2.633      1 Template:Related_articles_start
  3.40%    2.316      1 Template:Remove
-->

<!-- Saved in parser cache with key archwiki:pcache:idhash:20165-0!canonical and timestamp 20200212124733 and revision id 596768
 -->
</div></div>
		
		<div class="printfooter">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=PCI_passthrough_via_OVMF&amp;oldid=596768">https://wiki.archlinux.org/index.php?title=PCI_passthrough_via_OVMF&amp;oldid=596768</a>"</div>
		
		<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="https://wiki.archlinux.org/index.php/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="https://wiki.archlinux.org/index.php/Category:Virtualization" title="Category:Virtualization">Virtualization</a></li></ul></div><div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul><li><a href="https://wiki.archlinux.org/index.php/Category:Pages_or_sections_flagged_with_Template:Accuracy" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li><li><a href="https://wiki.archlinux.org/index.php/Category:Pages_or_sections_flagged_with_Template:Expansion" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li><li><a href="https://wiki.archlinux.org/index.php/Category:Pages_with_broken_package_links" title="Category:Pages with broken package links">Pages with broken package links</a></li><li><a href="https://wiki.archlinux.org/index.php/Category:Sections_flagged_with_Template:Remove" title="Category:Sections flagged with Template:Remove">Sections flagged with Template:Remove</a></li></ul></div></div>
		
		<div class="visualClear"></div>
		
	</div>
</div>

		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
									<div id="p-personal" role="navigation" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-createaccount"><a href="https://wiki.archlinux.org/index.php?title=Special:CreateAccount&amp;returnto=PCI+passthrough+via+OVMF" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li><li id="pt-login"><a href="https://wiki.archlinux.org/index.php?title=Special:UserLogin&amp;returnto=PCI+passthrough+via+OVMF" title="You are encouraged to log in; however, it is not mandatory [Alt+Shift+o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
							<li id="ca-nstab-main" class="selected"><span><a href="https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF" title="View the content page [Alt+Shift+c]" accesskey="c">Page</a></span></li><li id="ca-talk"><span><a href="https://wiki.archlinux.org/index.php/Talk:PCI_passthrough_via_OVMF" rel="discussion" title="Discussion about the content page [Alt+Shift+t]" accesskey="t">Discussion</a></span></li>						</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label">
						<h3 id="p-variants-label">
							<span>Variants</span>
						</h3>
						<ul class="menu">
													</ul>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
							<li id="ca-view" class="collapsible selected"><span><a href="https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF">Read</a></span></li><li id="ca-viewsource" class="collapsible"><span><a href="https://wiki.archlinux.org/index.php?title=PCI_passthrough_via_OVMF&amp;action=edit" title="This page is protected.
You can view its source [Alt+Shift+e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="https://wiki.archlinux.org/index.php?title=PCI_passthrough_via_OVMF&amp;action=history" title="Past revisions of this page [Alt+Shift+h]" accesskey="h">View history</a></span></li>						</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label" style="">
						<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span></h3>
						<ul class="menu">
													</ul>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>
						<form action="/index.php" id="searchform">
							<div id="simpleSearch">
								<input type="search" name="search" placeholder="Search ArchWiki" title="Search ArchWiki [Alt+Shift+f]" accesskey="f" id="searchInput" tabindex="1" autocomplete="off"><input type="hidden" value="Special:Search" name="title"><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton">							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="https://wiki.archlinux.org/index.php/Main_page" title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>
			<div class="body">
								<ul>
					<li id="n-mainpage-description"><a href="https://wiki.archlinux.org/index.php/Main_page" title="Visit the main page [Alt+Shift+z]" accesskey="z">Main page</a></li><li id="n-Table-of-contents"><a href="https://wiki.archlinux.org/index.php/Table_of_contents">Table of contents</a></li><li id="n-portal"><a href="https://wiki.archlinux.org/index.php/Getting_involved" title="Various ways Archers can contribute to the community">Getting involved</a></li><li id="n-currentevents"><a href="https://wiki.archlinux.org/index.php/ArchWiki:News" title="The latest lowdown on the wiki">Wiki news</a></li><li id="n-randompage"><a href="https://wiki.archlinux.org/index.php/Special:Random" title="Load a random page [Alt+Shift+x]" accesskey="x">Random page</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-Interaction" aria-labelledby="p-Interaction-label">
			<h3 id="p-Interaction-label">Interaction</h3>
			<div class="body">
								<ul>
					<li id="n-help"><a href="https://wiki.archlinux.org/index.php/Category:Help" title="Wiki navigation, reading, and editing help">Help</a></li><li id="n-Contributing"><a href="https://wiki.archlinux.org/index.php/ArchWiki:Contributing">Contributing</a></li><li id="n-recentchanges"><a href="https://wiki.archlinux.org/index.php/Special:RecentChanges" title="A list of recent changes in the wiki [Alt+Shift+r]" accesskey="r">Recent changes</a></li><li id="n-Recent-talks"><a href="https://wiki.archlinux.org/index.php/Special:RecentChanges?namespace=0&amp;invert=1" rel="nofollow">Recent talks</a></li><li id="n-newpages"><a href="https://wiki.archlinux.org/index.php/Special:NewPages">New pages</a></li><li id="n-Statistics"><a href="https://wiki.archlinux.org/index.php/ArchWiki:Statistics">Statistics</a></li><li id="n-Requests"><a href="https://wiki.archlinux.org/index.php/ArchWiki:Requests">Requests</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Tools</h3>
			<div class="body">
								<ul>
					<li id="t-whatlinkshere"><a href="https://wiki.archlinux.org/index.php/Special:WhatLinksHere/PCI_passthrough_via_OVMF" title="A list of all wiki pages that link here [Alt+Shift+j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="https://wiki.archlinux.org/index.php/Special:RecentChangesLinked/PCI_passthrough_via_OVMF" rel="nofollow" title="Recent changes in pages linked from this page [Alt+Shift+k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="https://wiki.archlinux.org/index.php/Special:SpecialPages" title="A list of all special pages [Alt+Shift+q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://wiki.archlinux.org/index.php?title=PCI_passthrough_via_OVMF&amp;printable=yes" rel="alternate" title="Printable version of this page [Alt+Shift+p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://wiki.archlinux.org/index.php?title=PCI_passthrough_via_OVMF&amp;oldid=596768" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://wiki.archlinux.org/index.php?title=PCI_passthrough_via_OVMF&amp;action=info" title="More information about this page">Page information</a></li>				</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-lang" aria-labelledby="p-lang-label">
			<h3 id="p-lang-label">In other languages</h3>
			<div class="body">
								<ul>
					<li class="interlanguage-link interwiki-ja"><a href="https://wiki.archlinux.jp/index.php/OVMF_%E3%81%AB%E3%82%88%E3%82%8B_PCI_%E3%83%91%E3%82%B9%E3%82%B9%E3%83%AB%E3%83%BC" title="OVMF  PCI   " hreflang="ja" class="interlanguage-link-target" lang="ja"></a></li><li class="interlanguage-link interwiki-zh-hans"><a href="https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="PCI passthrough via OVMF  " hreflang="zh-Hans" class="interlanguage-link-target" lang="zh-Hans"></a></li>				</ul>
							</div>
		</div>
				</div>
		</div>
				<div id="footer" role="contentinfo">
						<ul id="footer-info">
								<li id="footer-info-lastmod"> This page was last edited on 4 February 2020, at 02:18.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
							</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="https://wiki.archlinux.org/index.php/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="https://wiki.archlinux.org/index.php/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
								<li id="footer-places-disclaimer"><a href="https://wiki.archlinux.org/index.php/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
											</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		

<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.190","walltime":"0.196","ppvisitednodes":{"value":2606,"limit":1000000},"ppgeneratednodes":{"value":6813,"limit":1000000},"postexpandincludesize":{"value":36350,"limit":2097152},"templateargumentsize":{"value":19687,"limit":2097152},"expansiondepth":{"value":5,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":6685,"limit":5000000},"timingprofile":["100.00%   68.031      1 -total"," 18.24%   12.406    125 Template:Ic"," 15.30%   10.411     47 Template:Hc","  6.07%    4.128     16 Template:Note","  4.46%    3.032      1 Template:Accuracy","  4.38%    2.983      3 Template:Expansion","  4.24%    2.884      5 Template:META_Message","  4.08%    2.775     10 Template:Pkg","  3.87%    2.633      1 Template:Related_articles_start","  3.40%    2.316      1 Template:Remove"]},"cachereport":{"timestamp":"20200212124733","ttl":86400,"transientcontent":false}}});mw.config.set({"wgBackendResponseTime":43});});</script>



<div style="display: none; font-size: 13px;" class="suggestions"><div class="suggestions-results"></div><div class="suggestions-special"></div></div></body><!-- Cached/compressed 20200213041406 --></html>